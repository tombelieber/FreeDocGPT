from __future__ import annotations

from typing import Dict

import streamlit as st


# Minimal translation catalog (expand as needed)
SUPPORTED_LOCALES = ["en", "zh-Hant", "zh-Hans", "es", "ja"]


def normalize_locale(code: str | None) -> str:
    if not code:
        return "en"
    s = str(code).strip()
    if not s:
        return "en"
    l = s.lower().replace("_", "-")
    # Direct matches
    if l in ("en", "es", "ja", "zh-hant", "zh-hans"):
        return {"zh-hant": "zh-Hant", "zh-hans": "zh-Hans"}.get(l, l)
    # English
    if l.startswith("en"):
        return "en"
    # Spanish
    if l.startswith("es"):
        return "es"
    # Japanese
    if l.startswith("ja") or l.startswith("jp"):
        return "ja"
    # Chinese
    if l.startswith("zh"):
        if "hant" in l or any(x in l for x in ("tw", "hk", "mo")):
            return "zh-Hant"
        if "hans" in l or any(x in l for x in ("cn", "sg", "my")):
            return "zh-Hans"
        # default ambiguous zh to Traditional (can be adjusted)
        return "zh-Hant"
    # Fallback
    return "en"


_TRANSLATIONS: Dict[str, Dict[str, str]] = {
    "en": {
        "app.title": "📚 FreeDocGPT",
        "app.subtitle": "Free, local document AI assistant — drop files in `documents/` and start asking questions.",
        "sidebar.document_management": "📁 Document Management",
        "sidebar.documents_folder": "📂 Documents folder: `./{folder}/`",
        "sidebar.index_new_docs": "🔄 Index New Documents",
        "sidebar.found_docs": "Found {count} document(s)",
        "sidebar.auto_detect": "🤖 AI-Powered Auto-Detection",
        "sidebar.auto_detect_help": "Uses LLM to detect document types and languages.",
        "sidebar.auto_detect_caption1": "✨ AI analyzes each document to tune processing",
        "sidebar.auto_detect_caption2": "🌐 Supports English, 中文 (简/繁), Español, 日本語",
        "sidebar.no_docs_found": "No documents found in `./{folder}/`",
        "sidebar.supported_formats_title": "Supported formats:",
        "sidebar.vision_support_title": "🎨 Vision Support:",
        "sidebar.vision_support_detail": "✅ PDF images, charts, and diagrams via LLaVA",
        "sidebar.indexed_docs": "📊 Indexed Documents",
        "sidebar.reset_index": "🧹 Reset Index",
        "sidebar.reset_index_help": "Drop LanceDB table and clear Tantivy index",
        "sidebar.no_index_yet": "No documents indexed yet",
        "sidebar.total_chunks": "Total Chunks",
        "sidebar.reset_ok": "Index reset completed.",
        "sidebar.reset_fail": "Failed to reset index. You can manually delete the .lancedb folder and reload.",
        "sidebar.tantivy_warn": "Tantivy clear warning: {err}",
        "search.header": "🔍 Search Settings",
        "search.mode": "Search Mode",
        "search.mode_help": "Choose search strategy: Hybrid combines keyword and vector search",
        "search.alpha_label": "Vector vs Keyword Weight",
        "search.alpha_help": "0 = Pure keyword search, 1 = Pure vector search, 0.5 = Balanced",
        "search.results_label": "Number of Results",
        "search.results_help": "Number of document chunks to retrieve",
        "search.weight_caption": "📝 Keyword: {kw}% | 🎯 Vector: {vec}%",
        "chat.header": "💬 Ask Questions",
        "chat.input": "Ask a question about your documents...",
        "buttons.clear_chat": "🔄 Clear Chat",
        "chat.response_metrics": "📊 Response Metrics",
        "chat.metrics_total_time": "Total time: {secs:.2f}s",
        "chat.metrics_first_token": "First token: {secs:.2f}s",
        "chat.metrics_tokens": "Tokens: {count}",
        "chat.metrics_speed": "Speed: {rate:.1f} tokens/sec",
        "footer.embedding_model": "Embedding Model:",
        "footer.generation_model": "Generation Model:",
        "chat.metric_response_time": "⏱️ Response Time",
        "chat.metric_first_token": "🚀 First Token",
        "chat.metric_tokens": "📝 Tokens",
        "chat.metric_speed": "⚡ Speed",
        "chat.searching": "🔍 Searching through documents...",
        "chat.found_chunks": "✅ Found {count} relevant chunks in {secs:.2f}s",
        "chat.found_chunks_hybrid": " (Hybrid: {kw} keyword + {vec} vector)",
        "chat.found_chunks_keyword": " (Keyword: {kw} results)",
        "chat.found_chunks_vector": " (Vector: {vec} results)",
        "chat.sources": "📖 Sources",
        "chat.search_completed": "Search completed in {secs:.2f} seconds using {mode} mode",
        "chat.thinking": "🤔 Thinking...",
        "chat.initializing_model": "🚀 Initializing AI model...",
        "chat.checking_model": "🔍 Checking model availability...",
        "chat.processing_visuals": "🎨 Processing visuals and charts...",
        "chat.extracting_visuals": "📊 Extracting visual content from documents...",
        "chat.preparing_vision_response": "🧠 Preparing vision-enhanced response...",
        "chat.connecting_model": "🔗 Connecting to language model...",
        "chat.generating_response": "✨ Generating response...",
        "chat.first_token_received": "🚀 Response started!",
        "chat.streaming": "🔄 Streaming...",
        "chat.streaming_animated": "🔄 Streaming{dots}",
        "chat.complete": "✅ Complete",
        "chat.error_generating": "Error generating response: {err}",
        "chat.no_relevant": "I couldn't find any relevant information in the indexed documents. Please make sure documents are indexed.",
        "chat.no_relevant_title": "⚠️ No relevant documents found",
        "lang.selector": "🌐 Language / 語言 / 语言",
        "lang.en": "English",
        "lang.zh_hant": "繁體中文",
        "lang.zh_hans": "简体中文",
        "lang.es": "Español",
        "lang.ja": "日本語",

        # Settings panel
        "settings.title": "⚙️ Settings",
        "settings.doc_processing": "📊 Document Processing Settings",
        "settings.quick_presets": "🎯 Quick Presets",
        "settings.quick_presets_caption": "Optimized for common docs: Notion/Lark exports, PDFs, tech docs",
        "settings.preset_meeting": "📝 Meeting Notes",
        "settings.preset_prd": "📋 PRD/Specs",
        "settings.preset_tech": "💻 Tech Docs",
        "settings.preset_wiki": "📚 Wiki/KB",
        "settings.preset_applied_meeting": "📝 Applied Meeting Notes preset",
        "settings.preset_applied_prd": "📋 Applied PRD/Specs preset",
        "settings.preset_applied_tech": "💻 Applied Tech Docs preset",
        "settings.preset_applied_wiki": "📚 Applied Wiki/KB preset",
        "settings.chunk_size": "📏 Chunk Size (characters per segment)",
        "settings.chunk_help": "For Notion/Lark docs with mixed content, 1500-1800 is recommended.",
        "settings.overlap_size": "🔄 Overlap Size (shared text between chunks)",
        "settings.overlap_help": "For documents with code blocks, use 300-400.",
        "settings.results": "🔍 Search Results (number of relevant segments)",
        "settings.results_help": "For technical queries use 5-7, for simple Q&A use 3-5.",
        "settings.current_config": "📊 Current Configuration",
        "settings.metric_chunk": "Chunk Size",
        "settings.metric_overlap": "Overlap",
        "settings.metric_results": "Results",
        "settings.small_good": "⚠️ Small: Good for Q&A",
        "settings.large_good": "📦 Large: Good for code",
        "settings.balanced": "✅ Balanced",
        "settings.overlap_pct": "{pct:.0f}% of chunk size",
        "settings.focused": "🎯 Focused search",
        "settings.comprehensive": "🌐 Comprehensive",
        "settings.best_practices": "💡 Best Practices",
        "settings.bp_notion_title": "📌 For Notion/Lark Export:",
        "settings.bp_notion_list": "- Export as Markdown (.md) for best results\n- Notion: Settings → Export → Markdown & CSV\n- Lark/Feishu: More → Export → Markdown",
        "settings.bp_reco_title": "📊 Recommended Settings:",
        "settings.bp_reco_list": "- Meeting Notes: 600-800 chunk, 100 overlap\n- PRD/Specs: 1500 chunk, 300 overlap\n- Tech Docs: 1800 chunk, 400 overlap\n- Wiki/How-to: 1200 chunk, 200 overlap",
        "settings.prompt": "Prompt",
        "settings.prompt_active": "Active system prompt file:",
        "settings.preview_first300": "Preview first 300 chars",
        "settings.prompt_not_found": "Prompt file not found; using default built-in prompt.",
        "settings.prompt_could_not_read": "Could not read prompt file: {err}",
        "settings.reload_prompt": "🔁 Reload System Prompt",
        "settings.reload_ok": "System prompt reloaded.",
        "settings.reload_fail": "Failed to reload prompt: {err}",
        "settings.reload_na": "Search service not available to reload prompt.",
        "settings.models": "Models",
        "settings.ollama_prereq": "⚠️ Prerequisites Required:\n1. Install Ollama: `brew install ollama`\n2. Start Ollama: `ollama serve`\n3. Pull required models:\n   - `ollama pull embeddinggemma:300m`\n   - `ollama pull gpt-oss:20b`",
        "settings.embed_model": "Embedding Model",
        "settings.gen_model": "Generation Model",
        "settings.model_help": "Make sure this model is installed in Ollama",
        "settings.check_ollama": "🔍 Check Ollama Status",
        
        # Chat History
        "chat_history.header": "💬 Chat History",
        "chat_history.search_placeholder": "Search conversations...",
        "chat_history.found_count": "Found {count} conversation(s)",
        "chat_history.load_tooltip": "Click to load this conversation",
        "chat_history.loaded": "Loaded: {name}",
        "chat_history.rename": "Rename",
        "chat_history.delete": "Delete",
        "chat_history.export": "Export",
        "chat_history.no_search_results": "No conversations found matching '{query}'",
        "chat_history.no_conversations": "No saved conversations yet",
        "chat_history.new_conversation": "🆕 New Conversation",
        "chat_history.current_conversation": "Current Conversation",
        "chat_history.conversation_name": "Conversation Name",
        "chat_history.renamed": "Conversation renamed",
        "chat_history.status_saved": "✅ Saved",
        "chat_history.status_unsaved": "⚠️ Unsaved changes",
        "chat_history.save_conversation": "💾 Save Conversation",
        "chat_history.settings": "⚙️ History Settings",
        "chat_history.auto_save": "Auto-save conversations",
        "chat_history.auto_save_help": "Automatically save conversations every few messages",
        "chat_history.save_interval": "Save every N messages",
        "chat_history.interval_help": "How often to auto-save during conversation",
        "chat_history.cleanup": "🧹 Cleanup Old Conversations",
        "chat_history.cleaned_up": "Deleted {count} old conversations",
        "chat_history.no_cleanup_needed": "No old conversations to clean up",
        "chat_history.new_name": "New name",
        "chat_history.save": "Save",
        "chat_history.cancel": "Cancel",
        "chat_history.delete_warning": "⚠️ Delete '{name}'?",
        "chat_history.delete_confirm": "Delete",
        "chat_history.delete_success": "Conversation deleted",
        "chat_history.delete_error": "Failed to delete conversation",
        "chat_history.export_format": "Format",
        "chat_history.export_button": "Export",
        "chat_history.download": "Download",
        "chat_history.export_error": "Failed to export conversation",
        "chat_history.no_messages": "No messages to save",
        "chat_history.save_success": "Conversation saved: {name}",
        "chat_history.save_error": "Failed to save conversation",
        "chat_history.rename_success": "Conversation renamed",
        "chat_history.rename_error": "Failed to rename conversation",
        
        # Modern Chat History
        "chat_history.chats": "Chats",
        "chat_history.new_chat": "New Chat",
        "chat_history.recent": "Recent",
        "chat_history.pinned": "Pinned",
        "chat_history.no_pinned": "No pinned chats",
        "chat_history.click_to_load": "Click to load this chat",
        "chat_history.edit": "✏️ Edit",
        "chat_history.pin": "📌 Pin",
        "chat_history.unpin": "📌 Unpin",
        "chat_history.archive": "📁 Archive",
        "chat_history.today": "Today",
        "chat_history.yesterday": "Yesterday",
        "chat_history.last_7_days": "Last 7 days",
        "chat_history.last_30_days": "Last 30 days",
        "chat_history.older": "Older",
        
        # Context Visualizer
        "context.breakdown": "Context Breakdown",
        "context.free_space": "Free Space",
        "context.detailed_usage": "Detailed Token Usage",
        "context.optimization_tips": "💡 Optimization Tips",
        "context.warning_large_history": "⚠️ Conversation history is large. Consider starting a new chat for better performance.",
        "context.info_many_docs": "📄 Many documents in context. Try more specific queries to reduce retrieval size.",
        "context.error_high_usage": "🔴 Context usage is high (>75%). Response quality may degrade. Consider clearing history.",
        "context.warning_moderate_usage": "🟡 Context usage is moderate (>50%). Monitor token usage.",
        "context.success_healthy_usage": "🟢 Context usage is healthy (<50%). Plenty of room for conversation.",
        "context.total_used": "Total Used",
        "context.free_space_metric": "Free Space",
        "context.system_prompt": "System Prompt",
        "context.conversation_history": "Conversation History",
        "context.current_query": "Current Query",
        "context.retrieved_documents": "Retrieved Documents",
        
        # Ollama Utils
        "ollama.error_cannot_connect": "❌ Cannot connect to Ollama. Make sure it's running with: `ollama serve`",
        "ollama.error_gen_model_not_found": "❌ Generation model '{model}' not found. Please run: `ollama pull {model}`",
        "ollama.info_gen_model_available": "✅ Generation model '{model}' is available",
        "ollama.error_general": "❌ Ollama error: {error}",
        
        # General UI
        "ui.no_files_to_index": "No files to index",
        "ui.auto_detecting": "🤖 Auto-detecting document types for optimal processing...",
        "ui.corrupted_index_warning": "Detected corrupted index. Resetting LanceDB table; please re-index your documents.",
        "ui.documents": "📄 Documents",
        "ui.no_documents_found": "No documents found",
        "ui.supported_formats": "**Supported:** PDF, Word, Markdown, TXT, HTML, CSV, Excel, JSON",
        "ui.warning_permanent_delete": "⚠️ **Warning**: This will permanently delete all indexed documents and their embeddings!",
        "ui.reindex_needed": "You will need to re-index your documents to use search functionality.",
        "ui.no_documents_indexed": "No documents indexed",
        "ui.search": "🔍 Search",
        "ui.models": "🤖 Models",
        "ui.current_models": "**Current Models**",
        "ui.system_prompt": "**System Prompt**",
        "ui.settings": "⚙️ Settings",
        "ui.interface": "**Interface**",
        "ui.document_processing": "**Document Processing**",
        "ui.current_configuration": "**Current Configuration**",
        "ui.index_reset_completed": "✅ Index reset completed",
        "ui.index_reset_failed": "❌ Failed to reset index",
        
        # Settings Panel - Missing Keys
        "settings.tab_quick": "⚡ Quick Setup",
        "settings.tab_processing": "🔧 Processing", 
        "settings.tab_models": "🤖 Models",
        "settings.tab_interface": "🎨 Interface",
        "settings.doc_type_presets": "🎯 Document Type Presets",
        "settings.one_click_optimization": "One-click optimization for common document types",
        "settings.meeting_notes": "📝 Meeting Notes",
        "settings.meeting_notes_help": "Optimized for meeting notes and conversations",
        "settings.prd_specs": "📋 PRD/Specs", 
        "settings.prd_specs_help": "Best for product requirements and specifications",
        "settings.tech_docs": "💻 Tech Docs",
        "settings.tech_docs_help": "Ideal for code documentation and technical guides",
        "settings.wiki_kb": "📚 Wiki/KB",
        "settings.wiki_kb_help": "Perfect for knowledge base articles",
        "settings.applied_meeting_notes": "📝 Applied Meeting Notes preset",
        "settings.applied_prd_specs": "📋 Applied PRD/Specs preset",
        "settings.applied_tech_docs": "💻 Applied Tech Docs preset",
        "settings.applied_wiki_kb": "📚 Applied Wiki/KB preset",
        "settings.current_config_overview": "📊 Current Configuration",
        "settings.real_time_overview": "Real-time overview of your active settings",
        "settings.chunk_size_metric": "Chunk Size",
        "settings.overlap_metric": "Overlap",
        "settings.results_metric": "Results",
        "settings.small_good_qa": "⚠️ Small: Good for Q&A",
        "settings.large_good_code": "📦 Large: Good for code",
        "settings.balanced_setting": "✅ Balanced",
        "settings.overlap_percentage": "{pct:.0f}% of chunk size",
        "settings.focused_search": "🎯 Focused search",
        "settings.comprehensive_search": "🌐 Comprehensive",
        "settings.balanced_search": "⚖️ Balanced",
        "settings.quick_tips": "💡 Quick Tips & Best Practices",
        "settings.getting_started": "🚀 Getting Started:",
        "settings.getting_started_text": "- New user? Try **Meeting Notes** preset for most documents\n- Working with code? Use **Tech Docs** preset\n- Processing PDFs? **PRD/Specs** handles structured content well",
        "settings.performance_tips": "🎯 Performance Tips:",
        "settings.performance_tips_text": "- Smaller chunks = faster search, less context\n- Larger chunks = slower search, more context\n- Higher overlap = better coherence, more storage",
        "settings.core_processing": "🔧 Core Processing Settings",
        "settings.fine_tune_chunking": "Fine-tune how documents are chunked and processed",
        "settings.chunk_size_chars": "📏 Chunk Size (characters per segment)",
        "settings.mixed_content_recommendation": "For mixed content documents, 1500-1800 is recommended.",
        "settings.overlap_size_chars": "🔄 Overlap Size (shared text between chunks)",
        "settings.code_blocks_recommendation": "For documents with code blocks, use 300-400.",
        "settings.search_configuration": "🔍 Search Configuration",
        "settings.search_results_control": "Control how many results are returned",
        "settings.search_results_segments": "Search Results (number of relevant segments)",
        "settings.technical_qa_recommendation": "For technical queries use 5-7, for simple Q&A use 3-5.",
        "settings.focused_search_info": "🎯 **Focused Search**\nFaster, more precise results",
        "settings.balanced_search_info": "⚖️ **Balanced Search**\nGood mix of speed and coverage",
        "settings.comprehensive_search_info": "🌐 **Comprehensive Search**\nMore context, slower processing",
        "settings.doc_type_guidelines": "📋 Document Type Guidelines",
        "settings.optimized_settings_by_type": "🎯 Optimized Settings by Document Type",
        "settings.text_heavy_docs": "📝 Text-Heavy Documents:",
        "settings.text_heavy_list": "- Meeting Notes: 600-800 chunk, 100 overlap\n- Articles/Blogs: 800-1200 chunk, 150 overlap\n- Books/Long Form: 1200-1500 chunk, 200 overlap",
        "settings.structured_docs": "💻 Structured Documents:",
        "settings.structured_list": "- Technical Docs: 1500-1800 chunk, 300-400 overlap\n- Code Documentation: 1800-2000 chunk, 400 overlap\n- API References: 1000-1500 chunk, 200-300 overlap",
        "settings.export_format_recs": "📤 Export Format Recommendations",
        "settings.for_best_results": "📌 For Best Results:",
        "settings.notion_lark_export": "**Notion/Lark Export:**\n- ✅ Export as Markdown\n- ✅ Include images and tables\n- ⚠️ Avoid HTML export (complex formatting)",
        "settings.pdf_processing": "**PDF Processing:**\n- ✅ Text-based PDFs work best\n- ✅ Use higher chunk sizes (1500+)\n- ⚠️ Scanned PDFs may need OCR",
        "settings.code_documentation": "**Code Documentation:**\n- ✅ Markdown with code blocks\n- ✅ High overlap for code continuity\n- ✅ Include file structure context",
        "settings.prerequisites_setup": "⚙️ Prerequisites & Setup Guide",
        "settings.required_setup_steps": "🛠️ Required Setup Steps",
        "settings.install_ollama": "**1. Install Ollama:**\n```bash\nbrew install ollama\n```\n\n**2. Start Ollama Service:**\n```bash\nollama serve\n```",
        "settings.pull_models": "**3. Pull Required Models:**\n```bash\nollama pull embeddinggemma:300m\nollama pull gpt-oss:20b\n```",
        "settings.tip_keep_running": "💡 **Tip:** Keep Ollama running in the background for best performance",
        "settings.model_configuration": "🤖 Model Configuration",
        "settings.configure_models": "Configure which models to use for embeddings and generation",
        "settings.embedding_model": "🔤 Embedding Model", 
        "settings.embedding_model_help": "Model used for document embeddings and search",
        "settings.generation_model": "💬 Generation Model",
        "settings.generation_model_help": "Model used for response generation and chat",
        "settings.check_ollama_status": "🔍 Check Ollama Status",
        "settings.list_available_models": "📋 List Available Models",
        "settings.use_ollama_list": "Use `ollama list` in terminal to see installed models",
        "settings.system_prompt_config": "📝 System Prompt Configuration",
        "settings.customize_ai_responses": "Customize how the AI responds to your queries",
        "settings.customize_ai_behavior": "**Customize AI Behavior:**",
        "settings.edit_prompt": "✏️ Edit Prompt",
        "settings.file_info": "ℹ️ File Info",
        "settings.system_prompt_content": "System Prompt Content",
        "settings.edit_system_prompt_help": "Edit the system prompt that guides AI responses and behavior.",
        "settings.save_changes": "💾 Save Changes",
        "settings.reset": "🔄 Reset",
        "settings.reload": "🔁 Reload",
        "settings.prompt_saved_reloaded": "✅ System prompt saved to {filename} and reloaded!",
        "settings.error_saving_prompt": "❌ Error saving prompt: {error}",
        "settings.prompt_reset_success": "✅ Prompt reset to current language default",
        "settings.no_prompt_file_found": "⚠️ No prompt file found for current language",
        "settings.error_resetting": "❌ Error resetting: {error}",
        "settings.prompt_service_reloaded": "✅ System prompt service reloaded",
        "settings.failed_to_reload": "❌ Failed to reload: {error}",
        "settings.service_not_available": "⚠️ Search service not available",
        "settings.file_information": "**File Information:**",
        "settings.file_size": "File Size",
        "settings.content_length": "Content Length",
        "settings.show_content_preview": "Show content preview",
        "settings.preview_first_300": "**Preview (first 300 characters):**",
        "settings.performance_optimization": "🚀 Performance & Optimization Tips",
        "settings.model_selection_tips": "💡 Model Selection Tips",
        "settings.embedding_models_info": "**Embedding Models:**\n- `nomic-embed-text`: Fast, good for general documents\n- `embeddinggemma:300m`: Lightweight, mobile-friendly\n- `mxbai-embed-large`: Higher quality, more memory",
        "settings.generation_models_info": "**Generation Models:**\n- `gpt-oss:20b`: Balanced performance and speed\n- `llama3:8b`: Faster, good for simple queries\n- `llama3:70b`: Higher quality, requires more resources",
        "settings.performance_optimization_tips": "⚡ Performance Optimization\n- Keep Ollama service running continuously\n- Use smaller models for faster responses\n- Monitor system resources during heavy usage",
        "settings.notifications_feedback": "🔔 Notifications & Feedback",
        "settings.configure_audio_visual": "Configure audio and visual feedback",
        "settings.play_completion_sound": "🔊 Play sound when response completes",
        "settings.completion_sound_help": "Play a notification sound when AI finishes generating a response",
        "settings.visual_completion_indicator": "✨ Show visual completion indicator", 
        "settings.visual_indicator_help": "Coming soon: Visual indicators for response completion",
        "settings.display_layout": "🖥️ Display & Layout",
        "settings.customize_appearance": "Customize the appearance and layout",
        "settings.color_scheme": "🎨 Color Scheme", 
        "settings.color_scheme_help": "Coming soon: Theme customization",
        "settings.text_size": "📏 Text Size",
        "settings.text_size_help": "Coming soon: Adjustable text sizing",
        "settings.auto_system": "Auto (System)",
        "settings.light": "Light",
        "settings.dark": "Dark",
        "settings.small": "Small",
        "settings.medium": "Medium", 
        "settings.large": "Large",
        "settings.behavior_performance": "⚡ Behavior & Performance",
        "settings.control_interface_behavior": "Control how the interface behaves",
        "settings.auto_scroll": "🏃 Auto-scroll to latest message",
        "settings.auto_scroll_help": "Coming soon: Auto-scroll behavior control",
        "settings.auto_save_chat": "💾 Auto-save chat history",
        "settings.auto_save_chat_help": "Coming soon: Automatic chat history saving",
        "settings.coming_soon_advanced": "🚀 Coming Soon - Advanced Options",
        "settings.planned_interface_features": "🎯 Planned Interface Features",
        "settings.visual_customization": "🎨 Visual Customization:",
        "settings.visual_customization_list": "- 🌙 Dark/Light theme toggle\n- 🎨 Custom color schemes\n- 📱 Mobile-responsive layouts\n- 🖼️ Background customization",
        "settings.interaction_features": "⚡ Interaction Features:",
        "settings.interaction_features_list": "- ⌨️ Keyboard shortcuts\n- 📋 Quick action buttons  \n- 🔍 Enhanced search UI\n- 📊 Usage statistics display",
        "settings.want_specific_feature": "💡 **Want a specific feature?** These will be added based on user feedback and usage patterns.",
        "settings.current_session_info": "📊 Current Session Information",
        "settings.session_details": "🔍 Session Details",
        "settings.active_settings": "Active Settings",
        "settings.search_mode": "Search Mode", 
        "settings.results_limit": "Results Limit",
        
        # Sidebar - Missing Keys  
        "sidebar.folder": "📂 Folder: `./{folder}/`",
        "sidebar.found_documents": "Found {count} documents",
        "sidebar.ai_auto_detect": "🤖 AI Auto-detect",
        "sidebar.auto_detect_help": "Auto-detect document types and languages", 
        "sidebar.index_documents": "🔄 Index Documents",
        "sidebar.view_documents": "View documents",
        "sidebar.and_more": "... and {count} more",
        "sidebar.no_documents_found": "No documents found",
        "sidebar.supported_formats_basic": "**Supported:** PDF, Word, Markdown, TXT, HTML, CSV, Excel, JSON",
        "sidebar.indexed_metric": "Indexed",
        "sidebar.chunks_metric": "Chunks", 
        "sidebar.reset_index_button": "🧹 Reset Index",
        "sidebar.view_indexed": "View indexed",
        "sidebar.no_documents_indexed": "No documents indexed",
        "sidebar.search_tab": "### 🔍 Search",
        "sidebar.search_mode": "Search Mode",
        "sidebar.search_strategy_help": "Search strategy",
        "sidebar.search_strategy": "Search strategy",
        "sidebar.hybrid": "hybrid",
        "sidebar.vector": "vector", 
        "sidebar.keyword": "keyword",
        "sidebar.vector_keyword_balance": "Vector/Keyword Balance",
        "sidebar.keyword_vector_help": "0=Keyword only, 1=Vector only",
        "sidebar.keyword_percent": "📝 Keyword: {kw}% | 🎯 Vector: {vec}%",
        "sidebar.models_tab": "### 🤖 Models",
        "sidebar.current_models": "**Current Models**",
        "sidebar.embedding_model": "🔤 Embedding: {model}",
        "sidebar.generation_model": "💬 Generation: {model}",
        "sidebar.setup_guide": "Setup Guide",
        "sidebar.install_ollama_guide": "**Install Ollama:**\n```bash\nbrew install ollama\nollama serve\n```\n\n**Pull Models:**\n```bash\nollama pull embeddinggemma:300m\nollama pull gpt-oss:20b\n```",
        "sidebar.embedding_model_input": "Embedding Model",
        "sidebar.embedding_model_help": "Model for document embeddings",
        "sidebar.generation_model_input": "Generation Model", 
        "sidebar.generation_model_help": "Model for chat responses",
        "sidebar.check_ollama_status": "🔍 Check Ollama Status",
        "sidebar.edit_system_prompt": "Edit System Prompt",
        "sidebar.prompt_content": "Prompt Content",
        "sidebar.customize_ai_behavior": "Customize AI behavior",
        "sidebar.save_button": "💾 Save",
        "sidebar.reset_button": "🔄 Reset",
        "sidebar.saved": "✅ Saved!",
        "sidebar.error": "❌ Error: {error}",
        "sidebar.reset_success": "✅ Reset!",
        "sidebar.settings_tab": "### ⚙️ Settings",
        "sidebar.language": "Language",
        "sidebar.language_changed_success": "✅ Language changed and system prompt reloaded!",
        "sidebar.language_changed_warning": "⚠️ Language changed but failed to reload prompt: {error}",
        "sidebar.completion_sound": "🔊 Completion Sound",
        "sidebar.completion_sound_help": "Play sound when response completes",
        "sidebar.chunk_size_chars": "Chunk Size (characters)", 
        "sidebar.chunk_size_help": "**Chunk Size** determines how much text is processed together as one unit.\n\n**Smaller chunks (500-1000):**\n• Better for Q&A with specific facts\n• More precise but may lose context\n• Good for: FAQs, definitions, short articles\n\n**Medium chunks (1000-2000):** \n• Balanced approach for most documents\n• Preserves moderate context while staying focused\n• Good for: Technical docs, reports, general content\n\n**Larger chunks (2000-3000):**\n• Better for complex topics needing context\n• May be less precise but preserves relationships\n• Good for: Academic papers, detailed explanations, narratives",
        "sidebar.overlap_size_chars": "Overlap Size (characters)",
        "sidebar.overlap_size_help": "**Overlap Size** controls how much text is shared between adjacent chunks.\n\n**No overlap (0):**\n• Fastest processing, no duplication\n• Risk of breaking related concepts across chunks\n• Use when: Documents have clear section breaks\n\n**Small overlap (50-150):**\n• Minimal context preservation with good efficiency  \n• Helps maintain continuity between chunks\n• Use when: Well-structured documents\n\n**Medium overlap (150-300):**\n• Good balance of context and efficiency\n• Recommended for most document types\n• Helps AI understand relationships across boundaries\n\n**Large overlap (300-500):**\n• Maximum context preservation\n• More processing time and storage\n• Use when: Complex documents with interconnected concepts",
        "sidebar.results_count": "Results Count",
        "sidebar.results_count_help": "**Results Count** sets how many relevant document chunks are retrieved for each query.\n\n**Few results (1-3):**\n• Faster responses, lower token usage\n• More focused but may miss relevant information  \n• Good for: Simple questions, specific fact lookup\n\n**Medium results (4-8):**\n• Balanced approach for most queries\n• Good coverage without overwhelming the AI\n• Recommended for: General Q&A, document exploration\n\n**Many results (9-20):**\n• Comprehensive information gathering\n• Slower responses, higher token usage\n• Good for: Complex questions, research tasks, summarization\n\nNote: More results = better coverage but higher costs and slower responses",
        "sidebar.current_configuration": "**Current Configuration**",
        "sidebar.chunk_size_help_metric": "Characters per document chunk",
        "sidebar.overlap_help_metric": "Shared characters between chunks",  
        "sidebar.results_help_metric": "Chunks retrieved per query",
        "sidebar.reset_index_confirmation": "Reset Index Confirmation",
        "sidebar.warning_cannot_undo": "⚠️ **Warning**: This action cannot be undone!",
        "sidebar.will_permanently_delete": "This will permanently delete:",
        "sidebar.indexed_documents_embeddings": "- All indexed documents and their embeddings",
        "sidebar.vector_database_entries": "- Vector database entries",
        "sidebar.search_index_data": "- Search index data", 
        "sidebar.need_reindex": "You will need to re-index your documents to restore search functionality.",
        "sidebar.cancel": "❌ Cancel",
        "sidebar.confirm_reset": "🗑️ Confirm Reset",
        
        # Context and Memory - Missing Keys
        "context.memory_usage": "Memory: {used} / {total} tokens",
        "context.memory_status": "The AI can remember up to {limit} tokens of conversation before older messages are summarized.",
        "context.memory_full": "⚠️ Memory full - older messages may be summarized",
        "context.memory_high": "⚡ Memory getting full - monitor usage", 
        "context.memory_ok": "✅ Memory healthy - plenty of room for conversation",
        "context.memory_full_short": "Memory Full",
        "context.memory_high_short": "Memory High",
        "context.memory_ok_short": "Memory OK",
        "context.memory_optimized": "Memory Optimized",
        "context.removed_messages": "Removed {count} older messages ({tokens} tokens) to maintain performance",
        
        # Additional Missing Keys
        "common.save": "✓ Save",
        "common.cancel": "✗ Cancel",
        "common.delete": "Delete", 
        "common.yes": "Yes",
        "common.no": "No",
        "common.reset": "🔄 Reset",
        "common.reload": "🔁 Reload",
        "common.saved": "✅ Saved!",
        "common.reset_success": "✅ Reset!",
        "common.complete": "✅ Complete",
        "common.streaming": "🔄 Streaming...",
        "common.ai_thinking": "🤔 AI is thinking...",
        "common.untitled": "Untitled",
        "common.untitled_conversation": "Untitled Conversation",
        
        # Chat Interface - Missing Keys
        "chat.thinking_mode": "🤔 Thinking Mode",
        "chat.thinking_mode_help": "Show AI reasoning process",
        "chat.memory_usage": "Memory: {percentage}%",
        "chat.memory_fallback": "🟢 Memory: 0%",
        "chat.memory_tooltip": "Chat memory usage: {used} / {total} tokens ({percentage}%)\n\nThe AI can remember up to {total} tokens of conversation before older messages are summarized.",
        "chat.memory_tooltip_fallback": "Chat memory usage: 0 / 128k tokens (0%)\n\nThe AI can remember up to 128k tokens of conversation before older messages are summarized.",
        
        # Context Widget - Missing Keys  
        "context.memory_label": "Memory: {used} / {total} tokens",
        
        # Settings Panel - Additional Missing Keys
        "settings.system_prompt_content": "System Prompt Content",
        "settings.system_prompt_help": "Edit the system prompt that guides AI responses and behavior.",
        "settings.active_settings": "Active Settings",
        "settings.search_mode": "Search Mode", 
        "settings.results_limit": "Results Limit",
        "settings.color_scheme": "🎨 Color Scheme",
        "settings.text_size": "📏 Text Size",
        "settings.coming_soon_theme": "Coming soon: Theme customization",
        "settings.coming_soon_text_size": "Coming soon: Adjustable text sizing",
        "settings.coming_soon_auto_scroll": "Coming soon: Auto-scroll behavior control",
        "settings.coming_soon_auto_save": "Coming soon: Automatic chat history saving",
        "settings.coming_soon_visual_completion": "Coming soon: Visual indicators for response completion",
        
        # Settings Options
        "settings.color_auto": "Auto (System)",
        "settings.color_light": "Light",
        "settings.color_dark": "Dark",
        "settings.size_small": "Small",
        "settings.size_medium": "Medium",
        "settings.size_large": "Large",
        
        # Sidebar - Missing Keys for Upload and Models
        "sidebar.setup_guide": "Setup Guide",
        "sidebar.embedding_model_input": "Embedding Model",
        "sidebar.embedding_model_help": "Model for document embeddings",
        "sidebar.generation_model_input": "Generation Model",
        "sidebar.generation_model_help": "Model for chat responses", 
        "sidebar.edit_system_prompt": "Edit System Prompt",
        "sidebar.prompt_content": "Prompt Content",
        "sidebar.prompt_help": "Customize AI behavior",
        "sidebar.language": "Language",
        "sidebar.results_count": "Results Count",
        "sidebar.completion_sound": "🔊 Completion Sound",
        "sidebar.completion_sound_help": "Play sound when response completes",
        
        # Dialog Titles - Missing Keys
        "dialog.reset_index_confirmation": "Reset Index Confirmation",
        "dialog.remove_file_confirmation": "Remove File Confirmation", 
        "dialog.batch_remove_confirmation": "Remove Selected Files Confirmation",
        "dialog.remove_all_confirmation": "Remove All Files Confirmation",
        "dialog.file_manager": "File Manager",
        
        # Upload/File Management - Missing Keys
        "sidebar.select_all_visible": "☑️ All",
        "sidebar.batch_remove_warning": "⚠️ **Warning**: This will move selected files to trash!",
        "sidebar.files_to_remove_batch": "Files to remove:",
        "sidebar.files_selected": "files selected",
        "sidebar.confirm_remove_selected": "🗑️ Remove Selected",
        
        # Search Settings Panel - Missing Keys
        "sidebar.vector_keyword_balance": "Vector/Keyword Balance",
        "sidebar.hybrid_balance_help": "0=Keyword only, 1=Vector only",
        "sidebar.keyword_percent": "📝 Keyword: {percent}%",
        "sidebar.vector_percent": "🎯 Vector: {percent}%",
        "sidebar.chunk_size_slider": "Chunk Size (characters)",
        "sidebar.overlap_size_slider": "Overlap Size (characters)",
        
        # Chat History Actions - Missing Keys  
        "chat_history.edit_action": "Edit",
        "chat_history.pin_action": "Pin", 
        "chat_history.unpin_action": "Unpin",
        "chat_history.archive_action": "Archive",
        "chat_history.unarchive_action": "Unarchive",
        "chat_history.export_action": "Export", 
        "chat_history.delete_action": "Delete",
        "chat_history.recent": "Recent",
        "chat_history.pinned": "Pinned",
        "chat_history.no_search_results": "No chats found",
        "chat_history.no_pinned": "No pinned chats",
        "chat_history.click_to_load": "Click to load this chat",
        "chat_history.today": "Today",
        "chat_history.yesterday": "Yesterday",
        "chat_history.this_week": "This Week", 
        "chat_history.last_week": "Last Week",
        "chat_history.older": "Older",
        
        # Model Settings Panel - Missing Keys
        "sidebar.models_title": "### 🤖 Models", 
        "sidebar.current_models": "**Current Models**",
        "sidebar.embedding_current": "🔤 Embedding: {model}",
        "sidebar.generation_current": "💬 Generation: {model}",
        "sidebar.install_ollama": "**Install Ollama:**",
        "sidebar.pull_models": "**Pull Models:**",
        
        # Settings Panel - Missing Keys  
        "sidebar.settings_title": "### ⚙️ Settings",
        "sidebar.interface": "**Interface**",
        "sidebar.document_processing": "**Document Processing**",
        "sidebar.current_config": "**Current Configuration**",
        
        # Settings - More Missing Keys
        "settings.current_configuration_title": "#### 📊 Current Configuration", 
        "settings.current_config_caption": "Real-time overview of your active settings",
        "settings.chunk_size_metric": "Chunk Size",
        "settings.overlap_metric": "Overlap", 
        "settings.results_metric": "Results",
        "settings.small_qa": "⚠️ Small: Good for Q&A",
        "settings.large_code": "📦 Large: Good for code", 
        "settings.balanced": "✅ Balanced",
        "settings.focused_search": "🎯 Focused search",
        "settings.comprehensive": "🌐 Comprehensive",
        "settings.balanced_search": "⚖️ Balanced",
        "settings.core_processing_title": "#### 🔧 Core Processing Settings",
        "settings.core_processing_caption": "Fine-tune how documents are chunked and processed",
        "settings.search_config_title": "#### 🔍 Search Configuration", 
        "settings.search_config_caption": "Control how many results are returned",
        "settings.focused_search_info": "🎯 **Focused Search**\nFaster, more precise results",
        "settings.balanced_search_info": "⚖️ **Balanced Search**\nGood mix of speed and coverage",
        "settings.comprehensive_search_info": "🌐 **Comprehensive Search**\nMore context, slower processing",
        "settings.optimized_settings_title": "#### 🎯 Optimized Settings by Document Type",
        "settings.required_setup_title": "#### 🛠️ Required Setup Steps",
        "settings.tip_keep_ollama_running": "💡 **Tip:** Keep Ollama running in the background for best performance",
        "settings.model_config_title": "#### 🤖 Model Configuration",
        "settings.model_config_caption": "Configure which models to use for embeddings and generation",
        "settings.check_ollama_status": "🔍 Check Ollama Status",
        "settings.list_available_models": "📋 List Available Models",
        "settings.use_ollama_list_terminal": "Use `ollama list` in terminal to see installed models",
        "settings.system_prompt_config_title": "#### 📝 System Prompt Configuration",
        "settings.system_prompt_config_caption": "Customize how the AI responds to your queries",
        "settings.customize_ai_behavior": "**Customize AI Behavior:**",
        "settings.save_changes": "💾 Save Changes",
        "settings.prompt_reset_success": "✅ Prompt reset to current language default",
        "settings.no_prompt_file": "⚠️ No prompt file found for current language",
        "settings.system_prompt_reloaded": "✅ System prompt service reloaded",
        "settings.service_not_available": "⚠️ Search service not available",
        "settings.file_information": "**File Information:**",
        "settings.file_size": "File Size",
        "settings.content_length": "Content Length", 
        "settings.show_content_preview": "Show content preview",
        "settings.preview_300_chars": "**Preview (first 300 characters):**",
        "settings.prompt_not_found": "⚠️ Prompt file not found; using default built-in prompt.",
        "settings.notifications_title": "#### 🔔 Notifications & Feedback",
        "settings.notifications_caption": "Configure audio and visual feedback",
        "settings.display_layout_title": "#### 🖥️ Display & Layout",
        "settings.display_layout_caption": "Customize the appearance and layout",
        "settings.behavior_title": "#### ⚡ Behavior & Performance", 
        "settings.behavior_caption": "Control how the interface behaves",
        "settings.planned_features_title": "#### 🎯 Planned Interface Features",
        "settings.want_specific_feature": "💡 **Want a specific feature?** These will be added based on user feedback and usage patterns.",
        "settings.session_details_title": "#### 🔍 Session Details",
        
        # Sidebar - More Missing Keys
        "sidebar.search_title": "### 🔍 Search",
        "sidebar.models_title": "### 🤖 Models", 
        "sidebar.current_models": "**Current Models**",
        "sidebar.check_ollama_status": "🔍 Check Ollama Status",
        "sidebar.system_prompt": "**System Prompt**",
        "sidebar.save": "💾 Save",
        "sidebar.settings_title": "### ⚙️ Settings",
        "sidebar.language_success": "✅ Language changed and system prompt reloaded!",
        "sidebar.interface": "**Interface**",
        "sidebar.document_processing": "**Document Processing**",
        "sidebar.current_config": "**Current Configuration**",
        "sidebar.chunk_size_help": "Characters per document chunk",
        "sidebar.overlap_help": "Shared characters between chunks",
        "sidebar.results_help": "Chunks retrieved per query", 
        "sidebar.warning_cannot_undo": "⚠️ **Warning**: This action cannot be undone!",
        "sidebar.will_delete": "This will permanently delete:",
        "sidebar.delete_indexed_docs": "- All indexed documents and their embeddings",
        "sidebar.delete_vector_db": "- Vector database entries",
        "sidebar.delete_search_index": "- Search index data",
        "sidebar.need_reindex": "You will need to re-index your documents to restore search functionality.",
        "sidebar.cancel": "❌ Cancel",
        "sidebar.confirm_reset": "🗑️ Confirm Reset",
        "sidebar.index_reset_completed": "✅ Index reset completed",
        "sidebar.index_reset_failed": "❌ Failed to reset index",
        
        # Chat Interface - More Missing Keys  
        "chat.pipeline_stages": "**Pipeline Stages:**",
        "chat.documents_referenced": "### Documents Referenced:",
        "chat.smart_search_optimization": "🎯 Smart Search Optimization:",
        "chat.search_expanded": "🔄 Search expanded for better results",
        "chat.no_chunks_received": "🔄 No chunks received from stream, trying non-streaming mode...",
        "chat.search_expanded_for_results": "  🔄 Search expanded for better results",
        "chat.streaming": "🔄 Streaming...",
        "chat.ai_thinking": "🤔 AI is thinking...",
        
        # Settings Panel - Final Missing Keys
        "settings.display_layout_title": "#### 🖥️ Display & Layout",
        "settings.display_layout_caption": "Customize the appearance and layout",
        "settings.behavior_title": "#### ⚡ Behavior & Performance",
        "settings.behavior_caption": "Control how the interface behaves",
        "settings.planned_features_title": "#### 🎯 Planned Interface Features",
        "settings.want_specific_feature": "💡 **Want a specific feature?** These will be added based on user feedback and usage patterns.",
        "settings.session_details_title": "#### 🔍 Session Details",
        
        # Sidebar - Final Missing Keys
        "sidebar.search_service_unavailable": "⚠️ Search service not available, prompt will be reloaded on next query",
    },
    "zh-Hant": {
        "app.title": "📚 免費文件GPT",
        "app.subtitle": "免費、本地的文件AI助手——把檔案放進 `documents/` 就能開始發問。",
        "sidebar.document_management": "📁 檔案管理",
        "sidebar.documents_folder": "📂 檔案資料夾：`./{folder}/`",
        "sidebar.index_new_docs": "🔄 建立新索引",
        "sidebar.found_docs": "找到 {count} 份檔案",
        "sidebar.auto_detect": "🤖 AI 智能自動辨識",
        "sidebar.auto_detect_help": "使用 LLM 辨識文件類型與語言。",
        "sidebar.auto_detect_caption1": "✨ AI 會分析每份檔案並自動調整處理設定",
        "sidebar.auto_detect_caption2": "🌐 支援 English / 简体中文 / 繁體中文 / Español / 日本語 及混合內容",
        "sidebar.no_docs_found": "在 `./{folder}/` 找不到檔案",
        "sidebar.supported_formats_title": "支援格式：",
        "sidebar.vision_support_title": "🎨 影像辨識：",
        "sidebar.vision_support_detail": "✅ 透過 LLaVA 處理 PDF 圖像、圖表與截圖",
        "sidebar.supported_formats_list": "PDF、Word、Markdown、HTML、CSV、Excel、JSON、TXT 等",
        "sidebar.indexed_docs": "📊 已索引檔案",
        "sidebar.reset_index": "🧹 重設索引",
        "sidebar.reset_index_help": "清除 LanceDB 資料表並重置 Tantivy 索引",
        "sidebar.no_index_yet": "尚未建立任何索引",
        "sidebar.total_chunks": "總片段數",
        "sidebar.reset_ok": "索引已重設。",
        "sidebar.reset_fail": "重設失敗。你也可以手動刪除 .lancedb 資料夾後重新載入。",
        "sidebar.tantivy_warn": "Tantivy 清除警告：{err}",
        "search.header": "🔍 搜尋設定",
        "search.mode": "搜尋模式",
        "search.mode_help": "混合搜尋同時使用關鍵字與向量，比較聰明",
        "search.alpha_label": "向量 vs 關鍵字 權重",
        "search.alpha_help": "0 = 純關鍵字，1 = 純向量，0.5 = 平衡",
        "search.results_label": "結果數量",
        "search.results_help": "要擷取的文件片段數量",
        "search.weight_caption": "📝 關鍵字：{kw}% ｜ 🎯 向量：{vec}%",
        "chat.header": "💬 提問",
        "chat.input": "就你的檔案提出問題…",
        "buttons.clear_chat": "🔄 清除對話",
        "chat.response_metrics": "📊 回應指標",
        "chat.metrics_total_time": "總時間：{secs:.2f} 秒",
        "chat.metrics_first_token": "第一個 Token：{secs:.2f} 秒",
        "chat.metrics_tokens": "Token 數：{count}",
        "chat.metrics_speed": "速度：{rate:.1f} tokens/sec",
        "footer.embedding_model": "Embedding 模型：",
        "footer.generation_model": "生成模型：",
        "chat.metric_response_time": "⏱️ 回應時間",
        "chat.metric_first_token": "🚀 第一個 Token",
        "chat.metric_tokens": "📝 Token 數",
        "chat.metric_speed": "⚡ 速度",
        "chat.searching": "🔍 正在搜尋檔案…",
        "chat.found_chunks": "✅ 找到 {count} 個相關片段，用時 {secs:.2f} 秒",
        "chat.found_chunks_hybrid": "（混合：{kw} 關鍵字 + {vec} 向量）",
        "chat.found_chunks_keyword": "（關鍵字：{kw} 筆）",
        "chat.found_chunks_vector": "（向量：{vec} 筆）",
        "chat.sources": "📖 來源",
        "chat.search_completed": "搜尋完成，用時 {secs:.2f} 秒，模式：{mode}",
        "chat.thinking": "🤔 思考中…",
        "chat.initializing_model": "🚀 初始化 AI 模型…",
        "chat.checking_model": "🔍 檢查模型可用性…",
        "chat.processing_visuals": "🎨 處理視覺圖表…",
        "chat.extracting_visuals": "📊 從文件中提取視覺內容…",
        "chat.preparing_vision_response": "🧠 準備視覺增強回應…",
        "chat.connecting_model": "🔗 連接語言模型…",
        "chat.generating_response": "✨ 生成回應…",
        "chat.first_token_received": "🚀 開始回應！",
        "chat.streaming": "🔄 串流中…",
        "chat.streaming_animated": "🔄 串流中{dots}",
        "chat.complete": "✅ 完成",
        "chat.error_generating": "產生回應時發生錯誤：{err}",
        "chat.no_relevant": "找不到相關內容，請先確認已索引檔案。",
        "chat.no_relevant_title": "⚠️ 找不到相關文件",
        "lang.selector": "🌐 語言",
        "lang.en": "English",
        "lang.zh_hant": "繁體中文",
        "lang.zh_hans": "简体中文",
        "lang.es": "西班牙文",
        "lang.ja": "日文",

        "settings.title": "⚙️ 設定",
        "settings.doc_processing": "📊 文件處理設定",
        "settings.quick_presets": "🎯 快速預設",
        "settings.quick_presets_caption": "最佳化常見文件：Notion/飛書匯出、PDF、技術文件",
        "settings.preset_meeting": "📝 會議紀錄",
        "settings.preset_prd": "📋 PRD/規格",
        "settings.preset_tech": "💻 技術文件",
        "settings.preset_wiki": "📚 Wiki/知識庫",
        "settings.preset_applied_meeting": "📝 已套用：會議紀錄",
        "settings.preset_applied_prd": "📋 已套用：PRD/規格",
        "settings.preset_applied_tech": "💻 已套用：技術文件",
        "settings.preset_applied_wiki": "📚 已套用：Wiki/知識庫",
        "settings.chunk_size": "📏 片段大小（每段字元數）",
        "settings.chunk_help": "混合內容建議 1500–1800。",
        "settings.overlap_size": "🔄 重疊大小（片段間共用文字）",
        "settings.overlap_help": "含程式碼區塊的文件建議 300–400。",
        "settings.results": "🔍 搜尋結果數（相關片段數量）",
        "settings.results_help": "技術問題用 5–7，簡單問答用 3–5。",
        "settings.current_config": "📊 目前設定",
        "settings.metric_chunk": "片段大小",
        "settings.metric_overlap": "重疊",
        "settings.metric_results": "結果",
        "settings.small_good": "⚠️ 小：適合問答",
        "settings.large_good": "📦 大：適合程式碼",
        "settings.balanced": "✅ 平衡",
        "settings.overlap_pct": "重疊占比 {pct:.0f}%",
        "settings.focused": "🎯 精準搜尋",
        "settings.comprehensive": "🌐 全面",
        "settings.best_practices": "💡 最佳實務",
        "settings.bp_notion_title": "📌 Notion/飛書匯出：",
        "settings.bp_notion_list": "- 請匯出為 Markdown（.md）\n- Notion：Settings → Export → Markdown & CSV\n- 飛書/Feishu/Lark：更多 → 匯出 → Markdown",
        "settings.bp_reco_title": "📊 建議設定：",
        "settings.bp_reco_list": "- 會議紀錄：600–800，重疊 100\n- PRD/規格：1500，重疊 300\n- 技術文件：1800，重疊 400\n- Wiki/教學：1200，重疊 200",
        "settings.prompt": "提示詞（Prompt）",
        "settings.prompt_active": "使用中的系統提示檔：",
        "settings.preview_first300": "預覽前 300 字",
        "settings.prompt_not_found": "找不到提示檔；改用內建預設。",
        "settings.prompt_could_not_read": "無法讀取提示檔：{err}",
        "settings.reload_prompt": "🔁 重新載入系統提示",
        "settings.reload_ok": "已重新載入。",
        "settings.reload_fail": "重新載入失敗：{err}",
        "settings.reload_na": "目前無法重新載入提示。",
        "settings.models": "模型",
        "settings.ollama_prereq": "⚠️ 需要先準備：\n1. 安裝 Ollama：`brew install ollama`\n2. 啟動：`ollama serve`\n3. 下載模型：\n   - `ollama pull embeddinggemma:300m`\n   - `ollama pull gpt-oss:20b`",
        "settings.embed_model": "Embedding 模型",
        "settings.gen_model": "生成模型",
        "settings.model_help": "請先在 Ollama 安裝該模型",
        "settings.check_ollama": "🔍 檢查 Ollama 狀態",
        
        # Context Visualizer
        "context.breakdown": "上下文分解",
        "context.free_space": "可用空間",
        "context.detailed_usage": "詳細 Token 使用量",
        "context.optimization_tips": "💡 最佳化建議",
        "context.warning_large_history": "⚠️ 對話記錄太長，建議開始新對話以提升效能。",
        "context.info_many_docs": "📄 上下文中有很多文件。試試更具體的查詢來縮小檢索範圍。",
        "context.error_high_usage": "🔴 上下文使用率過高 (>75%)，回應品質可能下降。建議清除歷史記錄。",
        "context.warning_moderate_usage": "🟡 上下文使用率中等 (>50%)，請留意 Token 使用量。",
        "context.success_healthy_usage": "🟢 上下文使用率良好 (<50%)，還有足夠空間對話。",
        "context.total_used": "總使用量",
        "context.free_space_metric": "可用空間",
        "context.system_prompt": "系統提示",
        "context.conversation_history": "對話記錄",
        "context.current_query": "目前查詢",
        "context.retrieved_documents": "檢索文件",
        
        # Ollama Utils
        "ollama.error_cannot_connect": "❌ 無法連接 Ollama。請確保已執行：`ollama serve`",
        "ollama.error_gen_model_not_found": "❌ 找不到生成模型 '{model}'。請執行：`ollama pull {model}`",
        "ollama.info_gen_model_available": "✅ 生成模型 '{model}' 可用",
        "ollama.error_general": "❌ Ollama 錯誤：{error}",
        
        # General UI
        "ui.no_files_to_index": "沒有檔案需要索引",
        "ui.auto_detecting": "🤖 自動偵測文件類型以進行最佳處理...",
        "ui.corrupted_index_warning": "偵測到損壞的索引。重設 LanceDB 資料表；請重新索引您的文件。",
        "ui.documents": "📄 文件",
        "ui.no_documents_found": "找不到文件",
        "ui.supported_formats": "**支援格式：** PDF、Word、Markdown、TXT、HTML、CSV、Excel、JSON",
        "ui.warning_permanent_delete": "⚠️ **警告**：這將永久刪除所有已索引的文件及其嵌入！",
        "ui.reindex_needed": "您需要重新索引文件才能使用搜尋功能。",
        "ui.no_documents_indexed": "沒有已索引的文件",
        "ui.search": "🔍 搜尋",
        "ui.models": "🤖 模型",
        "ui.current_models": "**目前模型**",
        "ui.system_prompt": "**系統提示**",
        "ui.settings": "⚙️ 設定",
        "ui.interface": "**介面**",
        "ui.document_processing": "**文件處理**",
        "ui.current_configuration": "**目前設定**",
        "ui.index_reset_completed": "✅ 索引重設完成",
        "ui.index_reset_failed": "❌ 索引重設失敗",
        
        # Context and Memory
        "context.memory_usage": "記憶體：{used} / {total} tokens",
        "context.memory_status": "AI 最多能記住 {limit} tokens 的對話，之後會自動摘要舊訊息。",
        "context.memory_full": "⚠️ 記憶體已滿 - 舊訊息可能會被摘要",
        "context.memory_high": "⚡ 記憶體使用量偏高 - 請注意使用狀況", 
        "context.memory_ok": "✅ 記憶體健康 - 有足夠空間繼續對話",
        "context.memory_full_short": "記憶體已滿",
        "context.memory_high_short": "記憶體偏高",
        "context.memory_ok_short": "記憶體正常",
        "context.memory_optimized": "記憶體已最佳化",
        "context.removed_messages": "已移除 {count} 則舊訊息（{tokens} tokens）以維持效能",
        
        # Additional Missing Keys
        "common.untitled": "未命名",
        "common.untitled_conversation": "未命名對話",
        
        # Chat Interface - Missing Keys
        "chat.thinking_mode": "🤔 思考模式",
        "chat.thinking_mode_help": "顯示 AI 推理過程",
        "chat.memory_usage": "記憶體: {percentage}%",
        "chat.memory_fallback": "🟢 記憶體: 0%",
        "chat.memory_tooltip": "對話記憶體使用量: {used} / {total} tokens ({percentage}%)\n\nAI 最多能記住 {total} tokens 的對話，之後會自動摘要舊訊息。",
        "chat.memory_tooltip_fallback": "對話記憶體使用量: 0 / 128k tokens (0%)\n\nAI 最多能記住 128k tokens 的對話，之後會自動摘要舊訊息。",
        
        # Context Widget - Missing Keys  
        "context.memory_label": "記憶體: {used} / {total} tokens",
        
        # Settings Panel - Additional Missing Keys
        "settings.system_prompt_content": "系統提示內容",
        "settings.system_prompt_help": "編輯指導 AI 回應和行為的系統提示。",
        "settings.active_settings": "使用中設定",
        "settings.search_mode": "搜尋模式", 
        "settings.results_limit": "結果限制",
        "settings.color_scheme": "🎨 色彩配置",
        "settings.text_size": "📏 文字大小",
        "settings.coming_soon_theme": "即將推出：主題自訂",
        "settings.coming_soon_text_size": "即將推出：可調整文字大小",
        "settings.coming_soon_auto_scroll": "即將推出：自動捲動行為控制",
        "settings.coming_soon_auto_save": "即將推出：自動儲存聊天記錄",
        "settings.coming_soon_visual_completion": "即將推出：回應完成視覺指示器",
        
        # Settings Options
        "settings.color_auto": "自動（系統）",
        "settings.color_light": "淺色",
        "settings.color_dark": "深色",
        "settings.size_small": "小",
        "settings.size_medium": "中",
        "settings.size_large": "大",
        
        # Sidebar - Missing Keys for Upload and Models
        "sidebar.setup_guide": "設定指南",
        "sidebar.embedding_model_input": "嵌入模型",
        "sidebar.embedding_model_help": "用於文件嵌入的模型",
        "sidebar.generation_model_input": "生成模型",
        "sidebar.generation_model_help": "用於聊天回應的模型", 
        "sidebar.edit_system_prompt": "編輯系統提示",
        "sidebar.prompt_content": "提示內容",
        "sidebar.prompt_help": "自訂 AI 行為",
        "sidebar.language": "語言",
        "sidebar.results_count": "結果數量",
        "sidebar.completion_sound": "🔊 完成音效",
        "sidebar.completion_sound_help": "回應完成時播放音效",
        
        # Dialog Titles - Missing Keys
        "dialog.reset_index_confirmation": "重設索引確認",
        "dialog.remove_file_confirmation": "刪除檔案確認", 
        "dialog.batch_remove_confirmation": "刪除所選檔案確認",
        "dialog.remove_all_confirmation": "刪除所有檔案確認",
        "dialog.file_manager": "檔案管理器",
        
        # Upload/File Management - Missing Keys
        "sidebar.select_all_visible": "☑️ 全選",
        "sidebar.batch_remove_warning": "⚠️ **警告**：這將把所選檔案移至垃圾桶！",
        "sidebar.files_to_remove_batch": "要刪除的檔案：",
        "sidebar.files_selected": "個檔案已選擇",
        "sidebar.confirm_remove_selected": "🗑️ 刪除所選項目",
        
        # Search Settings Panel - Missing Keys
        "sidebar.vector_keyword_balance": "向量/關鍵字平衡",
        "sidebar.hybrid_balance_help": "0=僅關鍵字，1=僅向量",
        "sidebar.keyword_percent": "📝 關鍵字：{percent}%",
        "sidebar.vector_percent": "🎯 向量：{percent}%",
        "sidebar.chunk_size_slider": "區塊大小（字元數）",
        "sidebar.overlap_size_slider": "重疊大小（字元數）",
        
        # Chat History Actions - Missing Keys  
        "chat_history.edit_action": "編輯",
        "chat_history.pin_action": "釘選", 
        "chat_history.unpin_action": "取消釘選",
        "chat_history.archive_action": "封存",
        "chat_history.unarchive_action": "取消封存",
        "chat_history.export_action": "匯出", 
        "chat_history.delete_action": "刪除",
        "chat_history.recent": "最近",
        "chat_history.pinned": "已釘選",
        "chat_history.no_search_results": "找不到聊天記錄",
        "chat_history.no_pinned": "沒有釘選的聊天",
        "chat_history.click_to_load": "點擊載入此聊天",
        "chat_history.today": "今天",
        "chat_history.yesterday": "昨天",
        "chat_history.this_week": "本週", 
        "chat_history.last_week": "上週",
        "chat_history.older": "更早",
        
        # Model Settings Panel - Missing Keys
        "sidebar.models_title": "### 🤖 模型", 
        "sidebar.current_models": "**當前模型**",
        "sidebar.embedding_current": "🔤 嵌入：{model}",
        "sidebar.generation_current": "💬 生成：{model}",
        "sidebar.install_ollama": "**安裝 Ollama：**",
        "sidebar.pull_models": "**拉取模型：**",
        
        # Settings Panel - Missing Keys  
        "sidebar.settings_title": "### ⚙️ 設定",
        "sidebar.interface": "**介面**",
        "sidebar.document_processing": "**文件處理**",
        "sidebar.current_config": "**當前設定**",
    },
    "zh-Hans": {
        "app.title": "📚 免费文件GPT",
        "app.subtitle": "免费、本地的文件AI助手——把文件放进 `documents/` 就能开始提问。",
        "sidebar.document_management": "📁 文件管理",
        "sidebar.documents_folder": "📂 文件夹：`./{folder}/`",
        "sidebar.index_new_docs": "🔄 建立新索引",
        "sidebar.found_docs": "找到 {count} 个文件",
        "sidebar.auto_detect": "🤖 AI 智能自动识别",
        "sidebar.auto_detect_help": "使用 LLM 识别文档类型与语言。",
        "sidebar.auto_detect_caption1": "✨ AI 会分析每个文件并自动调整处理设置",
        "sidebar.auto_detect_caption2": "🌐 支持 English / 简体中文 / 繁體中文 / Español / 日本語 及混合内容",
        "sidebar.no_docs_found": "在 `./{folder}/` 找不到文件",
        "sidebar.supported_formats_title": "支持格式：",
        "sidebar.vision_support_title": "🎨 图像识别：",
        "sidebar.vision_support_detail": "✅ 通过 LLaVA 处理 PDF 图片、图表与截图",
        "sidebar.supported_formats_list": "PDF、Word、Markdown、HTML、CSV、Excel、JSON、TXT 等",
        "sidebar.indexed_docs": "📊 已索引文件",
        "sidebar.reset_index": "🧹 重置索引",
        "sidebar.reset_index_help": "清除 LanceDB 表并重置 Tantivy 索引",
        "sidebar.no_index_yet": "尚未建立任何索引",
        "sidebar.total_chunks": "总片段数",
        "sidebar.reset_ok": "索引已重置。",
        "sidebar.reset_fail": "重置失败。你也可以手动删除 .lancedb 文件夹后重新加载。",
        "sidebar.tantivy_warn": "Tantivy 清除警告：{err}",
        "search.header": "🔍 搜索设置",
        "search.mode": "搜索模式",
        "search.mode_help": "混合搜索结合关键字与向量，更聪明",
        "search.alpha_label": "向量 vs 关键字 权重",
        "search.alpha_help": "0 = 纯关键字，1 = 纯向量，0.5 = 平衡",
        "search.results_label": "结果数量",
        "search.results_help": "要获取的文档片段数量",
        "search.weight_caption": "📝 关键字：{kw}% ｜ 🎯 向量：{vec}%",
        "chat.header": "💬 提问",
        "chat.input": "就你的文件提出问题…",
        "buttons.clear_chat": "🔄 清除对话",
        "chat.response_metrics": "📊 响应指标",
        "chat.metrics_total_time": "总时间：{secs:.2f} 秒",
        "chat.metrics_first_token": "第一个 Token：{secs:.2f} 秒",
        "chat.metrics_tokens": "Token 数：{count}",
        "chat.metrics_speed": "速度：{rate:.1f} tokens/sec",
        "footer.embedding_model": "Embedding 模型：",
        "footer.generation_model": "生成模型：",
        "chat.metric_response_time": "⏱️ 响应时间",
        "chat.metric_first_token": "🚀 第一个 Token",
        "chat.metric_tokens": "📝 Token 数",
        "chat.metric_speed": "⚡ 速度",
        "chat.searching": "🔍 正在搜索文件…",
        "chat.found_chunks": "✅ 找到 {count} 个相关片段，用时 {secs:.2f} 秒",
        "chat.found_chunks_hybrid": "（混合：{kw} 关键字 + {vec} 向量）",
        "chat.found_chunks_keyword": "（关键字：{kw} 条）",
        "chat.found_chunks_vector": "（向量：{vec} 条）",
        "chat.sources": "📖 来源",
        "chat.search_completed": "搜索完成，用时 {secs:.2f} 秒，模式：{mode}",
        "chat.thinking": "🤔 思考中…",
        "chat.initializing_model": "🚀 初始化 AI 模型…",
        "chat.checking_model": "🔍 检查模型可用性…",
        "chat.processing_visuals": "🎨 处理视觉图表…",
        "chat.extracting_visuals": "📊 从文档中提取视觉内容…",
        "chat.preparing_vision_response": "🧠 准备视觉增强响应…",
        "chat.connecting_model": "🔗 连接语言模型…",
        "chat.generating_response": "✨ 生成响应…",
        "chat.first_token_received": "🚀 开始响应！",
        "chat.streaming": "🔄 流式输出中…",
        "chat.streaming_animated": "🔄 流式输出中{dots}",
        "chat.complete": "✅ 完成",
        "chat.error_generating": "生成回答时发生错误：{err}",
        "chat.no_relevant": "找不到相关内容，请先确认已建立索引。",
        "chat.no_relevant_title": "⚠️ 找不到相关文件",
        "lang.selector": "🌐 语言",
        "lang.en": "English",
        "lang.zh_hant": "繁體中文",
        "lang.zh_hans": "简体中文",
        "lang.es": "西班牙语",
        "lang.ja": "日语",

        "settings.title": "⚙️ 设置",
        "settings.doc_processing": "📊 文档处理设置",
        "settings.quick_presets": "🎯 快速预设",
        "settings.quick_presets_caption": "优化常见文档：Notion/飞书导出、PDF、技术文档",
        "settings.preset_meeting": "📝 会议记录",
        "settings.preset_prd": "📋 PRD/规格",
        "settings.preset_tech": "💻 技术文档",
        "settings.preset_wiki": "📚 Wiki/知识库",
        "settings.preset_applied_meeting": "📝 已应用：会议记录",
        "settings.preset_applied_prd": "📋 已应用：PRD/规格",
        "settings.preset_applied_tech": "💻 已应用：技术文档",
        "settings.preset_applied_wiki": "📚 已应用：Wiki/知识库",
        "settings.chunk_size": "📏 片段大小（每段字符数）",
        "settings.chunk_help": "混合内容推荐 1500–1800。",
        "settings.overlap_size": "🔄 重叠大小（片段间共享文本）",
        "settings.overlap_help": "含代码块的文档推荐 300–400。",
        "settings.results": "🔍 搜索结果数（相关片段数量）",
        "settings.results_help": "技术问题用 5–7，简单问答用 3–5。",
        "settings.current_config": "📊 当前设置",
        "settings.metric_chunk": "片段大小",
        "settings.metric_overlap": "重叠",
        "settings.metric_results": "结果",
        "settings.small_good": "⚠️ 小：适合问答",
        "settings.large_good": "📦 大：适合代码",
        "settings.balanced": "✅ 平衡",
        "settings.overlap_pct": "重叠占比 {pct:.0f}%",
        "settings.focused": "🎯 精准搜索",
        "settings.comprehensive": "🌐 全面",
        "settings.best_practices": "💡 最佳实践",
        "settings.bp_notion_title": "📌 Notion/飞书导出：",
        "settings.bp_notion_list": "- 请导出为 Markdown（.md）\n- Notion：Settings → Export → Markdown & CSV\n- 飞书/Feishu/Lark：更多 → 导出 → Markdown",
        "settings.bp_reco_title": "📊 建议设置：",
        "settings.bp_reco_list": "- 会议记录：600–800，重叠 100\n- PRD/规格：1500，重叠 300\n- 技术文档：1800，重叠 400\n- Wiki/教程：1200，重叠 200",
        "settings.prompt": "提示词（Prompt）",
        "settings.prompt_active": "使用中的系统提示文件：",
        "settings.preview_first300": "预览前 300 字",
        "settings.prompt_not_found": "找不到提示文件；改用内置默认。",
        "settings.prompt_could_not_read": "无法读取提示文件：{err}",
        "settings.reload_prompt": "🔁 重新加载系统提示",
        "settings.reload_ok": "已重新加载。",
        "settings.reload_fail": "重新加载失败：{err}",
        "settings.reload_na": "目前无法重新加载提示。",
        "settings.models": "模型",
        "settings.ollama_prereq": "⚠️ 需要先准备：\n1. 安装 Ollama：`brew install ollama`\n2. 启动：`ollama serve`\n3. 下载模型：\n   - `ollama pull embeddinggemma:300m`\n   - `ollama pull gpt-oss:20b`",
        "settings.embed_model": "Embedding 模型",
        "settings.gen_model": "生成模型",
        "settings.model_help": "请先在 Ollama 安装该模型",
        "settings.check_ollama": "🔍 检查 Ollama 状态",
        
        # Context Visualizer
        "context.breakdown": "上下文分解",
        "context.free_space": "可用空间",
        "context.detailed_usage": "详细 Token 使用量",
        "context.optimization_tips": "💡 优化建议",
        "context.warning_large_history": "⚠️ 对话历史太长，建议开始新对话以提升性能。",
        "context.info_many_docs": "📄 上下文中有很多文档。尝试更具体的查询来缩小检索范围。",
        "context.error_high_usage": "🔴 上下文使用率过高 (>75%)，响应质量可能下降。建议清除历史记录。",
        "context.warning_moderate_usage": "🟡 上下文使用率中等 (>50%)，请留意 Token 使用量。",
        "context.success_healthy_usage": "🟢 上下文使用率良好 (<50%)，还有足够空间对话。",
        "context.total_used": "总使用量",
        "context.free_space_metric": "可用空间",
        "context.system_prompt": "系统提示",
        "context.conversation_history": "对话历史",
        "context.current_query": "当前查询",
        "context.retrieved_documents": "检索文档",
        
        # Ollama Utils
        "ollama.error_cannot_connect": "❌ 无法连接 Ollama。请确保已执行：`ollama serve`",
        "ollama.error_gen_model_not_found": "❌ 找不到生成模型 '{model}'。请执行：`ollama pull {model}`",
        "ollama.info_gen_model_available": "✅ 生成模型 '{model}' 可用",
        "ollama.error_general": "❌ Ollama 错误：{error}",
        
        # General UI
        "ui.no_files_to_index": "没有文件需要索引",
        "ui.auto_detecting": "🤖 自动检测文档类型以进行最佳处理...",
        "ui.corrupted_index_warning": "检测到损坏的索引。重置 LanceDB 表；请重新索引您的文档。",
        "ui.documents": "📄 文档",
        "ui.no_documents_found": "找不到文档",
        "ui.supported_formats": "**支持格式：** PDF、Word、Markdown、TXT、HTML、CSV、Excel、JSON",
        "ui.warning_permanent_delete": "⚠️ **警告**：这将永久删除所有已索引的文档及其嵌入！",
        "ui.reindex_needed": "您需要重新索引文档才能使用搜索功能。",
        "ui.no_documents_indexed": "没有已索引的文档",
        "ui.search": "🔍 搜索",
        "ui.models": "🤖 模型",
        "ui.current_models": "**当前模型**",
        "ui.system_prompt": "**系统提示**",
        "ui.settings": "⚙️ 设置",
        "ui.interface": "**界面**",
        "ui.document_processing": "**文档处理**",
        "ui.current_configuration": "**当前配置**",
        "ui.index_reset_completed": "✅ 索引重置完成",
        "ui.index_reset_failed": "❌ 索引重置失败",
        
        # Additional Missing Keys
        "common.untitled": "未命名",
        "common.untitled_conversation": "未命名对话",
        
        # Chat Interface - Missing Keys
        "chat.thinking_mode": "🤔 思考模式",
        "chat.thinking_mode_help": "显示 AI 推理过程",
        "chat.memory_usage": "内存: {percentage}%",
        "chat.memory_fallback": "🟢 内存: 0%",
        "chat.memory_tooltip": "对话内存使用量: {used} / {total} tokens ({percentage}%)\n\nAI 最多能记住 {total} tokens 的对话，之后会自动摘要旧消息。",
        "chat.memory_tooltip_fallback": "对话内存使用量: 0 / 128k tokens (0%)\n\nAI 最多能记住 128k tokens 的对话，之后会自动摘要旧消息。",
        
        # Context Widget - Missing Keys  
        "context.memory_label": "内存: {used} / {total} tokens",
        
        # Settings Panel - Additional Missing Keys
        "settings.system_prompt_content": "系统提示内容",
        "settings.system_prompt_help": "编辑指导 AI 回应和行为的系统提示。",
        "settings.active_settings": "当前设置",
        "settings.search_mode": "搜索模式", 
        "settings.results_limit": "结果限制",
        "settings.color_scheme": "🎨 颜色方案",
        "settings.text_size": "📏 文字大小",
        "settings.coming_soon_theme": "即将推出：主题自定义",
        "settings.coming_soon_text_size": "即将推出：可调整文字大小",
        "settings.coming_soon_auto_scroll": "即将推出：自动滚动行为控制",
        "settings.coming_soon_auto_save": "即将推出：自动保存聊天记录",
        "settings.coming_soon_visual_completion": "即将推出：响应完成视觉指示器",
        
        # Settings Options
        "settings.color_auto": "自动（系统）",
        "settings.color_light": "浅色",
        "settings.color_dark": "深色",
        "settings.size_small": "小",
        "settings.size_medium": "中",
        "settings.size_large": "大",
    },
    "es": {
        "app.title": "📚 DocumentoGPT",
        "app.subtitle": "Asistente AI local y gratuito para tus documentos — pon archivos en `documents/` y pregunta al instante.",
        "sidebar.document_management": "📁 Gestión de Documentos",
        "sidebar.documents_folder": "📂 Carpeta de documentos: `./{folder}/`",
        "sidebar.index_new_docs": "🔄 Indexar nuevos documentos",
        "sidebar.found_docs": "Se encontraron {count} documento(s)",
        "sidebar.auto_detect": "🤖 Detección automática con IA",
        "sidebar.auto_detect_help": "Usa un LLM para detectar tipos e idiomas de documentos.",
        "sidebar.auto_detect_caption1": "✨ La IA analiza cada documento para ajustar el procesamiento",
        "sidebar.auto_detect_caption2": "🌐 Compatible con English, 中文 (简/繁), Español, 日本語",
        "sidebar.no_docs_found": "No se encontraron documentos en `./{folder}/`",
        "sidebar.supported_formats_title": "Formatos compatibles:",
        "sidebar.vision_support_title": "🎨 Soporte de visión:",
        "sidebar.vision_support_detail": "✅ Imágenes, gráficos y capturas en PDF (LLaVA)",
        "sidebar.supported_formats_list": "PDF, Word, Markdown, HTML, CSV, Excel, JSON, TXT, etc.",
        "sidebar.indexed_docs": "📊 Documentos indexados",
        "sidebar.reset_index": "🧹 Reiniciar índice",
        "sidebar.reset_index_help": "Eliminar la tabla de LanceDB y limpiar el índice Tantivy",
        "sidebar.no_index_yet": "Aún no hay documentos indexados",
        "sidebar.total_chunks": "Fragmentos totales",
        "sidebar.reset_ok": "Índice reiniciado correctamente.",
        "sidebar.reset_fail": "Error al reiniciar. Puedes borrar la carpeta .lancedb y recargar.",
        "sidebar.tantivy_warn": "Advertencia al limpiar Tantivy: {err}",
        "search.header": "🔍 Configuración de búsqueda",
        "search.mode": "Modo de búsqueda",
        "search.mode_help": "Híbrido combina palabras clave y búsqueda vectorial",
        "search.alpha_label": "Peso: Vector vs Palabras clave",
        "search.alpha_help": "0 = Solo palabras clave, 1 = Solo vectorial, 0.5 = Balanceado",
        "search.results_label": "Número de resultados",
        "search.results_help": "Cantidad de fragmentos a recuperar",
        "search.weight_caption": "📝 Palabras clave: {kw}% | 🎯 Vector: {vec}%",
        "chat.header": "💬 Haz preguntas",
        "chat.input": "Haz una pregunta sobre tus documentos…",
        "buttons.clear_chat": "🔄 Limpiar chat",
        "chat.response_metrics": "📊 Métricas de respuesta",
        "chat.metrics_total_time": "Tiempo total: {secs:.2f}s",
        "chat.metrics_first_token": "Primer token: {secs:.2f}s",
        "chat.metrics_tokens": "Tokens: {count}",
        "chat.metrics_speed": "Velocidad: {rate:.1f} tokens/seg",
        "footer.embedding_model": "Modelo de embedding:",
        "footer.generation_model": "Modelo de generación:",
        "chat.metric_response_time": "⏱️ Tiempo de respuesta",
        "chat.metric_first_token": "🚀 Primer token",
        "chat.metric_tokens": "📝 Tokens",
        "chat.metric_speed": "⚡ Velocidad",
        "chat.searching": "🔍 Buscando en los documentos…",
        "chat.found_chunks": "✅ {count} fragmentos relevantes en {secs:.2f}s",
        "chat.found_chunks_hybrid": " (Híbrido: {kw} palabras clave + {vec} vector)",
        "chat.found_chunks_keyword": " (Palabras clave: {kw} resultados)",
        "chat.found_chunks_vector": " (Vector: {vec} resultados)",
        "chat.sources": "📖 Fuentes",
        "chat.search_completed": "Búsqueda completada en {secs:.2f}s (modo {mode})",
        "chat.thinking": "🤔 Pensando…",
        "chat.initializing_model": "🚀 Inicializando modelo de IA…",
        "chat.checking_model": "🔍 Verificando disponibilidad del modelo…",
        "chat.processing_visuals": "🎨 Procesando gráficos y elementos visuales…",
        "chat.extracting_visuals": "📊 Extrayendo contenido visual de documentos…",
        "chat.preparing_vision_response": "🧠 Preparando respuesta mejorada con visión…",
        "chat.connecting_model": "🔗 Conectando al modelo de lenguaje…",
        "chat.generating_response": "✨ Generando respuesta…",
        "chat.first_token_received": "🚀 ¡Respuesta iniciada!",
        "chat.streaming": "🔄 Transmitiendo…",
        "chat.streaming_animated": "🔄 Transmitiendo{dots}",
        "chat.complete": "✅ Completado",
        "chat.error_generating": "Error generando la respuesta: {err}",
        "chat.no_relevant": "No encontré información relevante en los documentos indexados. Asegúrate de indexarlos.",
        "chat.no_relevant_title": "⚠️ No se encontraron documentos relevantes",
        "lang.selector": "🌐 Idioma",
        "lang.en": "English",
        "lang.zh_hant": "繁體中文",
        "lang.zh_hans": "简体中文",
        "lang.es": "Español",
        "lang.ja": "日本語",

        "settings.title": "⚙️ Ajustes",
        "settings.doc_processing": "📊 Ajustes de procesamiento de documentos",
        "settings.quick_presets": "🎯 Ajustes rápidos",
        "settings.quick_presets_caption": "Optimizado para Notion/Lark, PDFs y docs técnicos",
        "settings.preset_meeting": "📝 Actas/Reuniones",
        "settings.preset_prd": "📋 PRD/Especificaciones",
        "settings.preset_tech": "💻 Documentación técnica",
        "settings.preset_wiki": "📚 Wiki/KB",
        "settings.preset_applied_meeting": "📝 Preajuste aplicado: Reuniones",
        "settings.preset_applied_prd": "📋 Preajuste aplicado: PRD/Especificaciones",
        "settings.preset_applied_tech": "💻 Preajuste aplicado: Documentación técnica",
        "settings.preset_applied_wiki": "📚 Preajuste aplicado: Wiki/KB",
        "settings.chunk_size": "📏 Tamaño de fragmento (caracteres por segmento)",
        "settings.chunk_help": "Para Notion/Lark con contenido mixto: 1500–1800 recomendado.",
        "settings.overlap_size": "🔄 Superposición (texto compartido entre fragmentos)",
        "settings.overlap_help": "Con bloques de código: usar 300–400.",
        "settings.results": "🔍 Resultados de búsqueda (fragmentos relevantes)",
        "settings.results_help": "Consultas técnicas 5–7; Q&A simple 3–5.",
        "settings.current_config": "📊 Configuración actual",
        "settings.metric_chunk": "Tamaño de fragmento",
        "settings.metric_overlap": "Superposición",
        "settings.metric_results": "Resultados",
        "settings.small_good": "⚠️ Pequeño: bueno para Q&A",
        "settings.large_good": "📦 Grande: bueno para código",
        "settings.balanced": "✅ Equilibrado",
        "settings.overlap_pct": "{pct:.0f}% del tamaño de fragmento",
        "settings.focused": "🎯 Búsqueda enfocada",
        "settings.comprehensive": "🌐 Integral",
        "settings.best_practices": "💡 Buenas prácticas",
        "settings.bp_notion_title": "📌 Exportación Notion/Lark:",
        "settings.bp_notion_list": "- Exporta a Markdown (.md)\n- Notion: Settings → Export → Markdown & CSV\n- Lark/Feishu: More → Export → Markdown",
        "settings.bp_reco_title": "📊 Configuración recomendada:",
        "settings.bp_reco_list": "- Reuniones: 600–800, superposición 100\n- PRD/Especificaciones: 1500, superposición 300\n- Técnica: 1800, superposición 400\n- Wiki/How-to: 1200, superposición 200",
        "settings.prompt": "Prompt",
        "settings.prompt_active": "Archivo de prompt activo:",
        "settings.preview_first300": "Previsualizar primeros 300 caracteres",
        "settings.prompt_not_found": "No se encontró el archivo de prompt; se usa el predeterminado.",
        "settings.prompt_could_not_read": "No se pudo leer el prompt: {err}",
        "settings.reload_prompt": "🔁 Recargar prompt del sistema",
        "settings.reload_ok": "Prompt recargado.",
        "settings.reload_fail": "Error al recargar: {err}",
        "settings.reload_na": "No es posible recargar el prompt ahora.",
        "settings.models": "Modelos",
        "settings.ollama_prereq": "⚠️ Requisitos previos:\n1. Instala Ollama: `brew install ollama`\n2. Inicia: `ollama serve`\n3. Descarga modelos:\n   - `ollama pull embeddinggemma:300m`\n   - `ollama pull gpt-oss:20b`",
        "settings.embed_model": "Modelo de embedding",
        "settings.gen_model": "Modelo generativo",
        "settings.model_help": "Asegúrate de que el modelo esté instalado en Ollama",
        "settings.check_ollama": "🔍 Verificar estado de Ollama",
        
        # Context Visualizer
        "context.breakdown": "Desglose del contexto",
        "context.free_space": "Espacio libre",
        "context.detailed_usage": "Uso detallado de tokens",
        "context.optimization_tips": "💡 Consejos de optimización",
        "context.warning_large_history": "⚠️ El historial de conversación es grande. Considera iniciar un nuevo chat para mejor rendimiento.",
        "context.info_many_docs": "📄 Muchos documentos en contexto. Prueba consultas más específicas para reducir el tamaño de recuperación.",
        "context.error_high_usage": "🔴 El uso del contexto es alto (>75%). La calidad de respuesta puede degradarse. Considera limpiar el historial.",
        "context.warning_moderate_usage": "🟡 El uso del contexto es moderado (>50%). Monitorea el uso de tokens.",
        "context.success_healthy_usage": "🟢 El uso del contexto es saludable (<50%). Mucho espacio para conversación.",
        "context.total_used": "Total usado",
        "context.free_space_metric": "Espacio libre",
        "context.system_prompt": "Prompt del sistema",
        "context.conversation_history": "Historial de conversación",
        "context.current_query": "Consulta actual",
        "context.retrieved_documents": "Documentos recuperados",
        
        # Ollama Utils
        "ollama.error_cannot_connect": "❌ No se puede conectar a Ollama. Asegúrate de que esté ejecutándose con: `ollama serve`",
        "ollama.error_gen_model_not_found": "❌ Modelo generativo '{model}' no encontrado. Ejecuta: `ollama pull {model}`",
        "ollama.info_gen_model_available": "✅ Modelo generativo '{model}' está disponible",
        "ollama.error_general": "❌ Error de Ollama: {error}",
        
        # General UI
        "ui.no_files_to_index": "No hay archivos para indexar",
        "ui.auto_detecting": "🤖 Detectando automáticamente tipos de documentos para procesamiento óptimo...",
        "ui.corrupted_index_warning": "Índice corrupto detectado. Reiniciando tabla LanceDB; por favor reindexe sus documentos.",
        "ui.documents": "📄 Documentos",
        "ui.no_documents_found": "No se encontraron documentos",
        "ui.supported_formats": "**Soportados:** PDF, Word, Markdown, TXT, HTML, CSV, Excel, JSON",
        "ui.warning_permanent_delete": "⚠️ **Advertencia**: ¡Esto eliminará permanentemente todos los documentos indexados y sus embeddings!",
        "ui.reindex_needed": "Necesitarás reindexar tus documentos para usar la funcionalidad de búsqueda.",
        "ui.no_documents_indexed": "No hay documentos indexados",
        "ui.search": "🔍 Búsqueda",
        "ui.models": "🤖 Modelos",
        "ui.current_models": "**Modelos actuales**",
        "ui.system_prompt": "**Prompt del sistema**",
        "ui.settings": "⚙️ Configuración",
        "ui.interface": "**Interfaz**",
        "ui.document_processing": "**Procesamiento de documentos**",
        "ui.current_configuration": "**Configuración actual**",
        "ui.index_reset_completed": "✅ Reinicio de índice completado",
        "ui.index_reset_failed": "❌ Falló el reinicio del índice",
        
        # Additional Missing Keys
        "common.untitled": "Sin título",
        "common.untitled_conversation": "Conversación sin título",
        
        # Chat Interface - Missing Keys
        "chat.thinking_mode": "🤔 Modo de pensamiento",
        "chat.thinking_mode_help": "Mostrar proceso de razonamiento de la IA",
        "chat.memory_usage": "Memoria: {percentage}%",
        "chat.memory_fallback": "🟢 Memoria: 0%",
        "chat.memory_tooltip": "Uso de memoria de chat: {used} / {total} tokens ({percentage}%)\n\nLa IA puede recordar hasta {total} tokens de conversación antes de resumir mensajes antiguos.",
        "chat.memory_tooltip_fallback": "Uso de memoria de chat: 0 / 128k tokens (0%)\n\nLa IA puede recordar hasta 128k tokens de conversación antes de resumir mensajes antiguos.",
        
        # Context Widget - Missing Keys  
        "context.memory_label": "Memoria: {used} / {total} tokens",
        
        # Settings Panel - Additional Missing Keys
        "settings.system_prompt_content": "Contenido del Prompt del Sistema",
        "settings.system_prompt_help": "Edita el prompt del sistema que guía las respuestas y el comportamiento de la IA.",
        "settings.active_settings": "Configuración Activa",
        "settings.search_mode": "Modo de Búsqueda", 
        "settings.results_limit": "Límite de Resultados",
        "settings.color_scheme": "🎨 Esquema de Colores",
        "settings.text_size": "📏 Tamaño del Texto",
        "settings.coming_soon_theme": "Próximamente: Personalización de temas",
        "settings.coming_soon_text_size": "Próximamente: Tamaño de texto ajustable",
        "settings.coming_soon_auto_scroll": "Próximamente: Control de desplazamiento automático",
        "settings.coming_soon_auto_save": "Próximamente: Guardado automático del historial",
        "settings.coming_soon_visual_completion": "Próximamente: Indicadores visuales de finalización",
        
        # Settings Options
        "settings.color_auto": "Automático (Sistema)",
        "settings.color_light": "Claro",
        "settings.color_dark": "Oscuro",
        "settings.size_small": "Pequeño",
        "settings.size_medium": "Mediano",
        "settings.size_large": "Grande",
    },
    "ja": {
        "app.title": "📚 ドキュメントGPT",
        "app.subtitle": "無料・ローカルのドキュメントAIアシスタント — `documents/` に入れて質問するだけ。",
        "sidebar.document_management": "📁 ドキュメント管理",
        "sidebar.documents_folder": "📂 ドキュメントフォルダ: `./{folder}/`",
        "sidebar.index_new_docs": "🔄 新しいドキュメントをインデックス",
        "sidebar.found_docs": "{count} 件のドキュメントを検出",
        "sidebar.auto_detect": "🤖 AI 自動判別",
        "sidebar.auto_detect_help": "LLM がドキュメントの種類と言語を判別します。",
        "sidebar.auto_detect_caption1": "✨ 各ドキュメントを解析して処理を最適化",
        "sidebar.auto_detect_caption2": "🌐 English・中文(简/繁)・Español・日本語 に対応",
        "sidebar.no_docs_found": "`./{folder}/` にドキュメントが見つかりません",
        "sidebar.supported_formats_title": "対応フォーマット:",
        "sidebar.vision_support_title": "🎨 画像理解:",
        "sidebar.vision_support_detail": "✅ LLaVA により PDF の画像・図・スクショに対応",
        "sidebar.supported_formats_list": "PDF、Word、Markdown、HTML、CSV、Excel、JSON、TXT など",
        "sidebar.indexed_docs": "📊 インデックス済みドキュメント",
        "sidebar.reset_index": "🧹 インデックスをリセット",
        "sidebar.reset_index_help": "LanceDB テーブル削除と Tantivy のクリア",
        "sidebar.no_index_yet": "まだインデックスがありません",
        "sidebar.total_chunks": "合計チャンク数",
        "sidebar.reset_ok": "インデックスをリセットしました。",
        "sidebar.reset_fail": "リセットに失敗しました。.lancedb フォルダを削除して再読み込みしてください。",
        "sidebar.tantivy_warn": "Tantivy クリア警告: {err}",
        "search.header": "🔍 検索設定",
        "search.mode": "検索モード",
        "search.mode_help": "ハイブリッドはキーワードとベクトルを併用",
        "search.alpha_label": "ベクトル vs キーワード 重み",
        "search.alpha_help": "0 = キーワードのみ, 1 = ベクトルのみ, 0.5 = バランス",
        "search.results_label": "結果の件数",
        "search.results_help": "取得するドキュメント断片の数",
        "search.weight_caption": "📝 キーワード: {kw}% | 🎯 ベクトル: {vec}%",
        "chat.header": "💬 質問する",
        "chat.input": "ドキュメントについて質問…",
        "buttons.clear_chat": "🔄 チャットをクリア",
        "chat.response_metrics": "📊 応答メトリクス",
        "chat.metrics_total_time": "合計時間: {secs:.2f}s",
        "chat.metrics_first_token": "最初のトークン: {secs:.2f}s",
        "chat.metrics_tokens": "トークン数: {count}",
        "chat.metrics_speed": "速度: {rate:.1f} tokens/秒",
        "footer.embedding_model": "Embedding モデル:",
        "footer.generation_model": "生成モデル:",
        "chat.metric_response_time": "⏱️ 応答時間",
        "chat.metric_first_token": "🚀 最初のトークン",
        "chat.metric_tokens": "📝 トークン数",
        "chat.metric_speed": "⚡ 速度",
        "chat.searching": "🔍 ドキュメントを検索中…",
        "chat.found_chunks": "✅ 関連チャンク {count} 件（{secs:.2f}s）",
        "chat.found_chunks_hybrid": "（ハイブリッド: キーワード {kw} + ベクトル {vec}）",
        "chat.found_chunks_keyword": "（キーワード: {kw} 件）",
        "chat.found_chunks_vector": "（ベクトル: {vec} 件）",
        "chat.sources": "📖 参照元",
        "chat.search_completed": "検索完了 {secs:.2f}s（{mode} モード）",
        "chat.thinking": "🤔 考え中…",
        "chat.streaming": "🔄 ストリーミング中…",
        "chat.complete": "✅ 完了",
        "chat.error_generating": "応答の生成でエラー: {err}",
        "chat.no_relevant": "インデックス済みドキュメントに関連情報が見つかりませんでした。まずインデックスしてください。",
        "chat.no_relevant_title": "⚠️ 関連ドキュメントが見つかりません",
        "lang.selector": "🌐 言語",
        "lang.en": "English",
        "lang.zh_hant": "繁體中文",
        "lang.zh_hans": "简体中文",
        "lang.es": "Español",
        "lang.ja": "日本語",

        "settings.title": "⚙️ 設定",
        "settings.doc_processing": "📊 ドキュメント処理の設定",
        "settings.quick_presets": "🎯 かんたんプリセット",
        "settings.quick_presets_caption": "Notion/Lark のエクスポート、PDF、技術文書に最適化",
        "settings.preset_meeting": "📝 会議メモ",
        "settings.preset_prd": "📋 PRD/仕様",
        "settings.preset_tech": "💻 技術文書",
        "settings.preset_wiki": "📚 Wiki/ナレッジ",
        "settings.preset_applied_meeting": "📝 適用: 会議メモ",
        "settings.preset_applied_prd": "📋 適用: PRD/仕様",
        "settings.preset_applied_tech": "💻 適用: 技術文書",
        "settings.preset_applied_wiki": "📚 適用: Wiki/ナレッジ",
        "settings.chunk_size": "📏 チャンクサイズ（1 セグメントの文字数）",
        "settings.chunk_help": "混在コンテンツには 1500–1800 を推奨。",
        "settings.overlap_size": "🔄 オーバーラップ（チャンク間の共有テキスト）",
        "settings.overlap_help": "コードブロックを含む文書は 300–400 を推奨。",
        "settings.results": "🔍 検索結果（関連セグメント数）",
        "settings.results_help": "技術的な質問 5–7、簡単な Q&A 3–5。",
        "settings.current_config": "📊 現在の設定",
        "settings.metric_chunk": "チャンクサイズ",
        "settings.metric_overlap": "オーバーラップ",
        "settings.metric_results": "結果",
        "settings.small_good": "⚠️ 小: Q&A 向け",
        "settings.large_good": "📦 大: コード向け",
        "settings.balanced": "✅ バランス",
        "settings.overlap_pct": "チャンク比 {pct:.0f}%",
        "settings.focused": "🎯 集中検索",
        "settings.comprehensive": "🌐 網羅的",
        "settings.best_practices": "💡 ベストプラクティス",
        "settings.bp_notion_title": "📌 Notion/Lark の書き出し:",
        "settings.bp_notion_list": "- 最高の結果には Markdown (.md) で書き出し\n- Notion: Settings → Export → Markdown & CSV\n- Lark/Feishu: More → Export → Markdown",
        "settings.bp_reco_title": "📊 推奨設定:",
        "settings.bp_reco_list": "- 会議メモ: 600–800、オーバーラップ 100\n- PRD/仕様: 1500、オーバーラップ 300\n- 技術文書: 1800、オーバーラップ 400\n- Wiki/How-to: 1200、オーバーラップ 200",
        "settings.prompt": "プロンプト",
        "settings.prompt_active": "使用中のシステムプロンプト:",
        "settings.preview_first300": "先頭 300 文字をプレビュー",
        "settings.prompt_not_found": "プロンプトが見つかりません。デフォルトを使用します。",
        "settings.prompt_could_not_read": "プロンプトを読み込めませんでした: {err}",
        "settings.reload_prompt": "🔁 システムプロンプトを再読み込み",
        "settings.reload_ok": "再読み込みしました。",
        "settings.reload_fail": "再読み込みに失敗しました: {err}",
        "settings.reload_na": "今はプロンプトを再読み込みできません。",
        "settings.models": "モデル",
        "settings.ollama_prereq": "⚠️ 事前準備:\n1. Ollama をインストール: `brew install ollama`\n2. 起動: `ollama serve`\n3. モデルを取得:\n   - `ollama pull embeddinggemma:300m`\n   - `ollama pull gpt-oss:20b`",
        "settings.embed_model": "Embedding モデル",
        "settings.gen_model": "生成モデル",
        "settings.model_help": "Ollama にモデルがインストールされていることを確認してください",
        "settings.check_ollama": "🔍 Ollama の状態を確認",
        
        # Context Visualizer
        "context.breakdown": "コンテキストの内訳",
        "context.free_space": "空き容量",
        "context.detailed_usage": "詳細なトークン使用量",
        "context.optimization_tips": "💡 最適化のヒント",
        "context.warning_large_history": "⚠️ 会話履歴が大きくなっています。パフォーマンス向上のため新しいチャットを開始することを検討してください。",
        "context.info_many_docs": "📄 コンテキストに多くのドキュメントがあります。検索範囲を減らすため、より具体的なクエリを試してください。",
        "context.error_high_usage": "🔴 コンテキスト使用量が高いです（>75%）。応答品質が低下する可能性があります。履歴のクリアを検討してください。",
        "context.warning_moderate_usage": "🟡 コンテキスト使用量が中程度です（>50%）。トークン使用量を監視してください。",
        "context.success_healthy_usage": "🟢 コンテキスト使用量は健全です（<50%）。会話の余裕はまだあります。",
        "context.total_used": "総使用量",
        "context.free_space_metric": "空き容量",
        "context.system_prompt": "システムプロンプト",
        "context.conversation_history": "会話履歴",
        "context.current_query": "現在のクエリ",
        "context.retrieved_documents": "取得されたドキュメント",
        
        # Ollama Utils
        "ollama.error_cannot_connect": "❌ Ollama に接続できません。次のコマンドで実行されていることを確認してください：`ollama serve`",
        "ollama.error_gen_model_not_found": "❌ 生成モデル '{model}' が見つかりません。次を実行してください：`ollama pull {model}`",
        "ollama.info_gen_model_available": "✅ 生成モデル '{model}' が利用可能です",
        "ollama.error_general": "❌ Ollama エラー：{error}",
        
        # General UI
        "ui.no_files_to_index": "インデックスするファイルがありません",
        "ui.auto_detecting": "🤖 最適な処理のためドキュメントタイプを自動検出中...",
        "ui.corrupted_index_warning": "破損したインデックスを検出しました。LanceDB テーブルをリセットしています；ドキュメントを再インデックスしてください。",
        "ui.documents": "📄 ドキュメント",
        "ui.no_documents_found": "ドキュメントが見つかりません",
        "ui.supported_formats": "**サポート形式：** PDF、Word、Markdown、TXT、HTML、CSV、Excel、JSON",
        "ui.warning_permanent_delete": "⚠️ **警告**：これはインデックスされたすべてのドキュメントとその埋め込みを永続的に削除します！",
        "ui.reindex_needed": "検索機能を使用するにはドキュメントを再インデックスする必要があります。",
        "ui.no_documents_indexed": "インデックスされたドキュメントがありません",
        "ui.search": "🔍 検索",
        "ui.models": "🤖 モデル",
        "ui.current_models": "**現在のモデル**",
        "ui.system_prompt": "**システムプロンプト**",
        "ui.settings": "⚙️ 設定",
        "ui.interface": "**インターフェース**",
        "ui.document_processing": "**ドキュメント処理**",
        "ui.current_configuration": "**現在の設定**",
        "ui.index_reset_completed": "✅ インデックスのリセットが完了しました",
        "ui.index_reset_failed": "❌ インデックスのリセットに失敗しました",
        
        # Additional Missing Keys
        "common.untitled": "無題",
        "common.untitled_conversation": "無題の会話",
        
        # Chat Interface - Missing Keys
        "chat.thinking_mode": "🤔 思考モード",
        "chat.thinking_mode_help": "AIの推論プロセスを表示",
        "chat.memory_usage": "メモリ: {percentage}%",
        "chat.memory_fallback": "🟢 メモリ: 0%",
        "chat.memory_tooltip": "チャットメモリ使用量: {used} / {total} tokens ({percentage}%)\n\nAIは{total}トークンまでの会話を記憶し、それを超えると古いメッセージが要約されます。",
        "chat.memory_tooltip_fallback": "チャットメモリ使用量: 0 / 128k tokens (0%)\n\nAIは128kトークンまでの会話を記憶し、それを超えると古いメッセージが要約されます。",
        
        # Context Widget - Missing Keys  
        "context.memory_label": "メモリ: {used} / {total} tokens",
        
        # Settings Panel - Additional Missing Keys
        "settings.system_prompt_content": "システムプロンプト内容",
        "settings.system_prompt_help": "AI の応答と動作を導くシステムプロンプトを編集します。",
        "settings.active_settings": "アクティブな設定",
        "settings.search_mode": "検索モード", 
        "settings.results_limit": "結果制限",
        "settings.color_scheme": "🎨 カラースキーム",
        "settings.text_size": "📏 文字サイズ",
        "settings.coming_soon_theme": "近日公開：テーマのカスタマイズ",
        "settings.coming_soon_text_size": "近日公開：調整可能な文字サイズ",
        "settings.coming_soon_auto_scroll": "近日公開：自動スクロール動作の制御",
        "settings.coming_soon_auto_save": "近日公開：チャット履歴の自動保存",
        "settings.coming_soon_visual_completion": "近日公開：応答完了の視覚的インジケーター",
        
        # Settings Options
        "settings.color_auto": "自動（システム）",
        "settings.color_light": "ライト",
        "settings.color_dark": "ダーク",
        "settings.size_small": "小",
        "settings.size_medium": "中",
        "settings.size_large": "大",
    },
}


def get_locale() -> str:
    return st.session_state.get("locale", "en")


def set_locale(locale: str) -> None:
    if locale in _TRANSLATIONS:
        st.session_state["locale"] = locale


def t(key: str, default: str | None = None, **kwargs) -> str:
    locale = get_locale()
    catalog = _TRANSLATIONS.get(locale, _TRANSLATIONS["en"])  # fallback to en
    text = catalog.get(key)
    if text is None:
        # fallback chain: default -> en -> key
        text = default or _TRANSLATIONS["en"].get(key, key)
    try:
        return text.format(**kwargs)
    except Exception:
        return text
